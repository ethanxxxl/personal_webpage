<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2023-06-04 Sun 05:52 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Portfolio</title>
<meta name="author" content="Ethan Smith" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type="text/css" href="style.css" />
</head>
<body>
<div id="content" class="content">
<h1 class="title">Portfolio</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgc696b6a">Introduction</a></li>
<li><a href="#orgad6c1e2">This Website</a></li>
<li><a href="#org8997e6d">Courses at Penn State</a>
<ul>
<li><a href="#org78836e3">Computer Engineering 472</a></li>
<li><a href="#org6125223">Computer Engineering 473</a></li>
</ul>
</li>
<li><a href="#orgdd6c273">Programming</a>
<ul>
<li><a href="#orga7dca06">Capabilities Overview</a></li>
<li><a href="#orgde0271a">Code Wars</a></li>
<li><a href="#org0840340">Hack Chat</a></li>
<li><a href="#org07f2241">Rust-Snake</a></li>
</ul>
</li>
</ul>
</div>
</div>
<nav>
    <a href="index.html">Home</a> |
    <a href="blogs.html">Blogs</a> |
    <a href="https://github.com/ethanxxxl">Github</a> |
    <a href="religion.html">Religion</a> |
    <a href="portfolio.html">Portfolio</a>
</nav>

<div class="portfolio-content">

<div id="outline-container-orgc696b6a" class="outline-2">
<h2 id="orgc696b6a">Introduction</h2>
<div class="outline-text-2" id="text-orgc696b6a">
<p>
Here I have compiled a subset of the things I have worked on throughout my life.
It is certainly not comprehensive and many projects are unfinished. I have
included things I have worked on both in school and on my own time.
</p>
</div>
</div>

<div id="outline-container-orgad6c1e2" class="outline-2">
<h2 id="orgad6c1e2">This Website</h2>
<div class="outline-text-2" id="text-orgad6c1e2">
<p>
I write this site using Emacs <code>org-mode</code>, making good use of its fantastic
export capabilities. My workflow is a little different for how emacs is
configured by default, however. <code>org-publish</code> is sort of set up for someone who
uses a single computer. My workflow involves a plethora of devices. I actively
edit this site on my macbook, and my desktop running Arch. I can foresee myself
also editing it on my desktop under Windows, or on other laptops running
whatever operating system I decide to run at that time.
</p>

<p>
Because this workflow, I wanted to be able to contain all the information
related to this website, including export information, inside of a single
directory tree. This immediately presents challenges, because <code>org-publish</code>
makes use of several global variables which add state to its export functions.
The main varaible of concern, however, is <code>org-publish-project-alist</code>. This
variable is intended to contain <b>all</b> projects that you ever work on. In theory,
there are benefits to this, but in practice, it just means my config files for
the website are spread all over my computer.
</p>

<p>
To solve this, I wrote some elisp which is bound to <code>SPC m P l</code>. Simply put, it
looks for a file named <code>export-config.el</code> in the root directory of your project.
This file defines a varaible called <code>org-publish-project-local-alist</code>, which
does the same thing as <code>org-publish-project-alist</code>, but <i>it&rsquo;s local</i> (real
complex stuff, I know).
</p>

<p>
There is one problem though. In the local alist, I can&rsquo;t use absolute paths,
because that would sort of defeat the purpose of being able to clone the git
repo anywhere and work on it. I don&rsquo;t really need absolute paths, because all
the files I reference in <code>export-config.el</code> are relative to the website root
directory. But when the publishing function runs, it gets really confused with
the relative paths (especially when using <code>#+include: ...</code> in my files.)
</p>

<p>
At this point, I pull an India Jones with these two variables, and swap them
before calling the <code>org-publish-all</code> function. This publishes the entire website
with a local configuration.
</p>

<p>
I moved the elisp I wrote for this modification into a separate file which is
loaded during startup for emacs. This file is shown below.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">org-publish-local.el -*- lexical-binding: t; -*-</span>

<span style="color: #4078f2;">(</span><span style="color: #a626a4;">add-hook</span>
 <span style="color: #4078f2;">'</span><span style="color: #6a1868;">org-mode-hook</span>
 <span style="color: #a626a4;">(</span><span style="color: #e45649;">lambda</span> <span style="color: #50a14f;">()</span>
   <span style="color: #50a14f;">(</span><span style="color: #e45649;">evil-define-key</span> <span style="color: #4078f2;">'</span><span style="color: #b751b6;">(</span>normal visual<span style="color: #b751b6;">)</span> <span style="color: #6a1868;">org-mode-map</span> <span style="color: #b751b6;">(</span><span style="color: #a626a4;">kbd</span> <span style="color: #50a14f;">"SPC m P l"</span><span style="color: #b751b6;">)</span> <span style="color: #4078f2;">#'</span><span style="color: #986801;">org-publish-local-project</span><span style="color: #50a14f;">)</span><span style="color: #a626a4;">)</span><span style="color: #4078f2;">)</span>

<span style="color: #9ca0a4;">;;; </span><span style="color: #50a14f; font-weight: bold;">NOTE:</span><span style="color: #9ca0a4;"> every file in a project is loaded into a buffer, and made current in</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">the org-publish-to function. That function tries to use existing buffers if</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">available, otherwise it will just create a new one, temporarily.</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">If a buffer already exists, but its path is screwed up, that will screw up</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">the path of its includes.</span>

<span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">state variable for local publish function</span>
<span style="color: #4078f2;">(</span><span style="color: #e45649;">setq</span> org-publish-local-root nil<span style="color: #4078f2;">)</span>
<span style="color: #4078f2;">(</span><span style="color: #e45649;">defun</span> <span style="color: #a626a4;">org-publish-local-project</span> <span style="color: #a626a4;">(</span><span style="color: #a626a4;">project-root</span><span style="color: #a626a4;">)</span>
  <span style="color: #84888b; font-style: italic;">"command to publish projects not listed in ~org-publish-project-alist~.</span>

<span style="color: #84888b; font-style: italic;">This requrires the project alist to be defined as</span>
<span style="color: #84888b; font-style: italic;">org-publish-local-alist in a file called export-config.el in the</span>
<span style="color: #84888b; font-style: italic;">project root directory. When this command is called for the first</span>
<span style="color: #84888b; font-style: italic;">time during a session, the user will be prompted to select the</span>
<span style="color: #84888b; font-style: italic;">root directory for their project. This directory is remembered</span>
<span style="color: #84888b; font-style: italic;">between calls"</span>
  <span style="color: #a626a4;">(</span><span style="color: #e45649;">interactive</span> <span style="color: #50a14f;">(</span><span style="color: #b751b6;">list</span> <span style="color: #b751b6;">(</span><span style="color: #e45649;">if</span> org-publish-local-root org-publish-local-root
                       <span style="color: #4078f2;">(</span><span style="color: #e45649;">setq</span> org-publish-local-root
                             <span style="color: #a626a4;">(</span><span style="color: #a626a4;">read-directory-name</span> <span style="color: #50a14f;">"Select project root: "</span> <span style="color: #a626a4;">)</span><span style="color: #4078f2;">)</span><span style="color: #b751b6;">)</span><span style="color: #50a14f;">)</span><span style="color: #a626a4;">)</span>

  <span style="color: #a626a4;">(</span><span style="color: #e45649;">let</span> <span style="color: #50a14f;">(</span><span style="color: #b751b6;">(</span>config-file <span style="color: #4078f2;">(</span><span style="color: #b751b6;">concat</span> project-root <span style="color: #50a14f;">"export-config.el"</span><span style="color: #4078f2;">)</span><span style="color: #b751b6;">)</span><span style="color: #50a14f;">)</span>
    <span style="color: #50a14f;">(</span><span style="color: #e45649;">when</span> <span style="color: #b751b6;">(</span><span style="color: #b751b6;">file-exists-p</span> config-file<span style="color: #b751b6;">)</span>
      <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">file exists, so get the code from it</span>
      <span style="color: #b751b6;">(</span><span style="color: #b751b6;">require</span> <span style="color: #4078f2;">'</span><span style="color: #b751b6;">ox-publish</span><span style="color: #b751b6;">)</span>
      <span style="color: #b751b6;">(</span><span style="color: #b751b6;">load</span> config-file nil nil t<span style="color: #b751b6;">)</span>
      <span style="color: #b751b6;">(</span><span style="color: #e45649;">let</span> <span style="color: #4078f2;">(</span>tmp-alist
            <span style="color: #a626a4;">(</span><span style="color: #6a1868;">org-publish-use-timestamps-flag</span> nil<span style="color: #a626a4;">)</span>
            <span style="color: #a626a4;">(</span>buffer-directory <span style="color: #50a14f;">(</span><span style="color: #b751b6;">file-name-directory</span> <span style="color: #b751b6;">(</span><span style="color: #6a1868;">buffer-file-name</span><span style="color: #b751b6;">)</span><span style="color: #50a14f;">)</span><span style="color: #a626a4;">)</span><span style="color: #4078f2;">)</span> <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">force all files to be published</span>

        <span style="color: #4078f2;">(</span><span style="color: #e45649;">setq</span> org-publish-local-alist
              <span style="color: #a626a4;">(</span><span style="color: #a626a4;">map</span> <span style="color: #4078f2;">'</span><span style="color: #986801;">list</span>
                   <span style="color: #50a14f;">(</span><span style="color: #e45649;">lambda</span> <span style="color: #b751b6;">(</span>project<span style="color: #b751b6;">)</span>
                     <span style="color: #b751b6;">(</span><span style="color: #b751b6;">cons</span> <span style="color: #4078f2;">(</span><span style="color: #b751b6;">car</span> project<span style="color: #4078f2;">)</span>
                           <span style="color: #4078f2;">(</span><span style="color: #a626a4;">publish-local-fix-base-dir</span> org-publish-local-root
                                                           <span style="color: #a626a4;">(</span><span style="color: #b751b6;">cdr</span> project<span style="color: #a626a4;">)</span><span style="color: #4078f2;">)</span><span style="color: #b751b6;">)</span><span style="color: #50a14f;">)</span>
                   org-publish-local-alist<span style="color: #a626a4;">)</span><span style="color: #4078f2;">)</span>

        <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">the org-publish-expand-project function requires that</span>
        <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">org-publish-project-alist contain all projects. save the current</span>
        <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">value of org-publish-project-alist, and restore it after this</span>
        <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">function is ran.</span>
        <span style="color: #4078f2;">(</span><span style="color: #e45649;">cl-rotatef</span> org-publish-local-alist <span style="color: #6a1868;">org-publish-project-alist</span><span style="color: #4078f2;">)</span>

        <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">publish all files in the project. </span><span style="color: #50a14f; font-weight: bold;">NOTE:</span><span style="color: #9ca0a4;"> this might not actually work.</span>
        <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">(cd org-publish-local-root)</span>
        <span style="color: #4078f2;">(</span><span style="color: #a626a4;">org-publish-projects</span> org-publish-local-alist<span style="color: #4078f2;">)</span>
        <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">(cd buffer-directory)</span>

        <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">restore project-alist variable</span>
        <span style="color: #4078f2;">(</span><span style="color: #e45649;">cl-rotatef</span> org-publish-local-alist <span style="color: #6a1868;">org-publish-project-alist</span><span style="color: #4078f2;">)</span><span style="color: #b751b6;">)</span><span style="color: #50a14f;">)</span><span style="color: #a626a4;">)</span><span style="color: #4078f2;">)</span>

<span style="color: #4078f2;">(</span><span style="color: #e45649;">defun</span> <span style="color: #a626a4;">publish-local-fix-base-dir</span> <span style="color: #a626a4;">(</span>root-dir plist<span style="color: #a626a4;">)</span>
  <span style="color: #84888b; font-style: italic;">"updates :base-directory in project plist to be a subdirectory of root-dir.</span>

<span style="color: #84888b; font-style: italic;">if :base-directory is absolute, then then this function simply</span>
<span style="color: #84888b; font-style: italic;">returns a copy of project. when :base-directory is relative, that</span>
<span style="color: #84888b; font-style: italic;">key is updated in a copy of project, which is returned.</span>

<span style="color: #84888b; font-style: italic;">root-dir is the directory where export-config.el is located. It</span>
<span style="color: #84888b; font-style: italic;">should be in the form of /foo/bar/</span>

<span style="color: #84888b; font-style: italic;">project is the project plist"</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">org-publish-fix-base-dir</span>
<span style="color: #9ca0a4;">;;;</span>

  <span style="color: #a626a4;">(</span><span style="color: #e45649;">let</span> <span style="color: #50a14f;">(</span><span style="color: #b751b6;">(</span>new-plist <span style="color: #4078f2;">(</span><span style="color: #a626a4;">copy-tree</span> plist<span style="color: #4078f2;">)</span><span style="color: #b751b6;">)</span>
        relative-dir<span style="color: #50a14f;">)</span>
    <span style="color: #50a14f;">(</span><span style="color: #e45649;">dolist</span> <span style="color: #b751b6;">(</span>key <span style="color: #4078f2;">'</span><span style="color: #4078f2;">(</span><span style="color: #a626a4;">:base-directory</span> <span style="color: #a626a4;">:publishing-directory</span><span style="color: #4078f2;">)</span> new-plist<span style="color: #b751b6;">)</span>
      <span style="color: #b751b6;">(</span><span style="color: #e45649;">setf</span> relative-dir <span style="color: #4078f2;">(</span><span style="color: #b751b6;">plist-get</span> plist key<span style="color: #4078f2;">)</span><span style="color: #b751b6;">)</span>
      <span style="color: #b751b6;">(</span><span style="color: #e45649;">cond</span> <span style="color: #4078f2;">(</span><span style="color: #a626a4;">(</span><span style="color: #a626a4;">f-relative-p</span> root-dir<span style="color: #a626a4;">)</span>
             <span style="color: #a626a4;">(</span><span style="color: #a626a4;">error</span> <span style="color: #50a14f;">"root-dir must be absolute: %S"</span> root-dir<span style="color: #a626a4;">)</span><span style="color: #4078f2;">)</span>
            <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">don't return error if base-directory is nil</span>
            <span style="color: #4078f2;">(</span><span style="color: #a626a4;">(</span><span style="color: #e45649;">and</span> relative-dir
                  <span style="color: #50a14f;">(</span><span style="color: #b751b6;">not</span> <span style="color: #b751b6;">(</span><span style="color: #b751b6;">directory-name-p</span> relative-dir<span style="color: #b751b6;">)</span><span style="color: #50a14f;">)</span><span style="color: #a626a4;">)</span>
             <span style="color: #a626a4;">(</span><span style="color: #a626a4;">error</span> <span style="color: #50a14f;">"%S must be a directory. (did you mean  %S?)"</span>
                    relative-dir
                    <span style="color: #50a14f;">(</span><span style="color: #b751b6;">concat</span> relative-dir <span style="color: #50a14f;">"/"</span><span style="color: #50a14f;">)</span><span style="color: #a626a4;">)</span><span style="color: #4078f2;">)</span><span style="color: #b751b6;">)</span>

      <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">update key with either expanded or replaced filename</span>
      <span style="color: #b751b6;">(</span><span style="color: #e45649;">setf</span> new-plist
            <span style="color: #4078f2;">(</span><span style="color: #e45649;">if</span> <span style="color: #a626a4;">(</span><span style="color: #e45649;">and</span> relative-dir
                     <span style="color: #50a14f;">(</span><span style="color: #a626a4;">f-relative-p</span> relative-dir<span style="color: #50a14f;">)</span><span style="color: #a626a4;">)</span>
                <span style="color: #a626a4;">(</span><span style="color: #b751b6;">plist-put</span> <span style="color: #50a14f;">(</span><span style="color: #a626a4;">copy-tree</span> new-plist<span style="color: #50a14f;">)</span> key
                           <span style="color: #50a14f;">(</span><span style="color: #b751b6;">expand-file-name</span> relative-dir root-dir<span style="color: #50a14f;">)</span><span style="color: #a626a4;">)</span>
              <span style="color: #a626a4;">(</span><span style="color: #a626a4;">copy-tree</span> new-plist<span style="color: #a626a4;">)</span><span style="color: #4078f2;">)</span><span style="color: #b751b6;">)</span><span style="color: #50a14f;">)</span><span style="color: #a626a4;">)</span><span style="color: #4078f2;">)</span>

<span style="color: #4078f2;">(</span><span style="color: #e45649;">setq</span> my-proj <span style="color: #a626a4;">(</span><span style="color: #a626a4;">copy-tree</span> org-publish-local-alist<span style="color: #a626a4;">)</span><span style="color: #4078f2;">)</span>

<span style="color: #4078f2;">(</span><span style="color: #a626a4;">publish-local-fix-base-dir</span> <span style="color: #50a14f;">"~/Documents/personal_webpage/"</span> <span style="color: #a626a4;">(</span><span style="color: #b751b6;">cdr</span> <span style="color: #50a14f;">(</span><span style="color: #b751b6;">car</span> my-proj<span style="color: #50a14f;">)</span><span style="color: #a626a4;">)</span><span style="color: #4078f2;">)</span>
my-proj

<span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">this function is no longer used in this file, but I like it so much, I can't</span>
<span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">bring myself to delete it.</span>
<span style="color: #4078f2;">(</span><span style="color: #e45649;">defun</span> <span style="color: #a626a4;">alist-update-key</span> <span style="color: #a626a4;">(</span>key value alist<span style="color: #a626a4;">)</span>
  <span style="color: #84888b; font-style: italic;">"returns a new alist with the value at key updated.</span>

<span style="color: #84888b; font-style: italic;">The whole structure of the alist is copied over (ie copy-tree vs</span>
<span style="color: #84888b; font-style: italic;">copy-list). the result is an alist with key removed, and a new</span>
<span style="color: #84888b; font-style: italic;">element with key pushed to the front of the alist. "</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">alist-update-key</span>
<span style="color: #9ca0a4;">;;;</span>
  <span style="color: #a626a4;">(</span><span style="color: #b751b6;">cons</span> <span style="color: #50a14f;">(</span><span style="color: #b751b6;">list</span> key value<span style="color: #50a14f;">)</span>
        <span style="color: #50a14f;">(</span><span style="color: #a626a4;">assq-delete-all</span> key <span style="color: #b751b6;">(</span><span style="color: #a626a4;">copy-tree</span> alist<span style="color: #b751b6;">)</span><span style="color: #50a14f;">)</span><span style="color: #a626a4;">)</span><span style="color: #4078f2;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8997e6d" class="outline-2">
<h2 id="org8997e6d">Courses at Penn State</h2>
<div class="outline-text-2" id="text-org8997e6d">
<p>
There were a few classes that I learned anything of substance during college.
</p>
</div>

<div id="outline-container-org78836e3" class="outline-3">
<h3 id="org78836e3">Computer Engineering 472</h3>
<div class="outline-text-3" id="text-org78836e3">
<p>
The <a href="https://www.cse.psu.edu/~kxc104/class/cmpen472/23s/index.html">coures webpage</a> has a lot of information about the course. Professor Choi
updates the course from year to year, so the curriculum posted there probably
isn&rsquo;t exactly what I did.
</p>

<p>
We spent the semester programming the HC12 Microcontroller in Assembly. We
learned about many different programming techniques specific to embedded
systems:
</p>
<ul class="org-ul">
<li>Peripherals</li>
<li>Memory access/management</li>
<li>Interrupts</li>
<li>Using the stack</li>
</ul>

<p>
We were assigned homework every week, which consisted of writing various
routines. It was incredibly important to complete these routines, because they
would be used in subsequent assignments. Many hard lessons about assembly were
learned in this class.
</p>

<p>
Some notable applications we made included a prefix notation calculator, and a
command line memory editor. I remember my excitement when I punched in the
address for the command prompt, and changed the symbol from a &rsquo;&gt;&rsquo; to &rsquo;$&rsquo;!
</p>

<p>
I have included the code from the first and last homeworks we completed in this
class to show the progression of program complexity.
</p>
</div>

<div id="outline-container-org41dbdc4" class="outline-4">
<h4 id="org41dbdc4">Homework 1</h4>
<div class="outline-text-4" id="text-org41dbdc4">
<div class="org-src-container">
<pre class="src src-asm"><span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">***********************************</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">*</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Title: StarFill (in Memory lane)</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">*</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Objective: COMPEN472 Homework 1</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">*</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Revision: V2</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">*</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Date: 27 Aug 2022</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">*</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Programmer: Ethan Smith</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">*</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Company: The Pennsylvania State University</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Electrical Engineering and Computer Science</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">*</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Algorithm: Simple while-loop demo of HCS12 assembly program</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">*</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Register use: A accumulator: character data to be filled</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">*               B accumulator: counter, number of filled locations</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">*               X register: memory address pointer</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">*</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Memory Use: RAM Locations from $3000 to $30C9</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">*</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Input: Parameters hard coded in the program</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">*</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Output: Data filled in memory locations, from $3000 to $30C9</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">*</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Observation: This program is designed for instruction purpose.</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* This program can be used as a 'loop' template</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">*</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Note: This is a good example of program comments</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* All Homework programs MUST have comments similar</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* to this Homework 1 Program. So, please use this</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* comment format for all your subsequent CMPEN 472</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Homework programs.</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">*</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Adding more explanations and comments help you and</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* others to understand your program later.</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">*</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Comments: This program is developed and simulated using CodeWarrior</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* development software</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">*</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">*********************************************************</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Parameter Declearation Section</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">*</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Export Symbols</span>
        <span style="color: #e45649;">XDEF</span>        Entry   <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">export 'pgstart' symbol</span>
        <span style="color: #e45649;">ABSENTRY</span>    Entry   <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">for assembly entry point</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Symbols and Macros</span>
<span style="color: #a626a4;">PORTA</span>   <span style="color: #e45649;">equ</span>         $0000   <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">i/o port addresses</span>
<span style="color: #a626a4;">PORTB</span>   <span style="color: #e45649;">equ</span>         $0001
<span style="color: #a626a4;">DDRA</span>    <span style="color: #e45649;">equ</span>         $0002
<span style="color: #a626a4;">DDRB</span>    <span style="color: #e45649;">equ</span>         $0003
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">*********************************************************</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Data Section</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">*</span>
        <span style="color: #e45649;">org</span>     $3000   <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">reserved memory starting address</span>
<span style="color: #a626a4;">here</span>    <span style="color: #e45649;">DS.B</span>    $CA     <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">202 memory locations reserved</span>
<span style="color: #a626a4;">count</span>   <span style="color: #e45649;">DC.B</span>    $CA     <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">constant. star count = 202</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">*********************************************************</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Program Section</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">*</span>
        <span style="color: #e45649;">org</span>     $3100   <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">program start address, in RAM</span>
<span style="color: #a626a4;">Entry</span>   <span style="color: #e45649;">ldaa</span>    #'*'    <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">load '*' into accumulator A</span>
        <span style="color: #e45649;">ldab</span>    count   <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">load star counter into B</span>
        <span style="color: #e45649;">ldx</span>     #here   <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">load address pointer into X</span>
<span style="color: #a626a4;">loop</span>    <span style="color: #e45649;">staa</span>    <span style="color: #50a14f;">0</span>, x    <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">put a star</span>
        <span style="color: #e45649;">inx</span>             <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">point to next location</span>
        <span style="color: #e45649;">decb</span>            <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">decrease counter</span>
        <span style="color: #e45649;">bne</span>     loop    <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">if not done, repeat</span>
<span style="color: #a626a4;">done</span>    <span style="color: #e45649;">bra</span>     done    <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">task finished</span>
                        <span style="color: #9ca0a4;">;  </span><span style="color: #9ca0a4;">do nothing</span>

<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">*</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Add any subroutines here</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">*</span>

        <span style="color: #e45649;">END</span>             <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">last line of a file</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7f4712c" class="outline-4">
<h4 id="org7f4712c">Homework 11</h4>
<div class="outline-text-4" id="text-org7f4712c">
<div class="org-src-container">
<pre class="src src-asm"><span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Title:          Analog signal decoder/transmitter and generator</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Objective:      CMPEN 472 Homework 11</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Revision:       V3.2  for CodeWarrior 5.2 Debugger Simulation</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Date:           30 November 2022</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Programmer:     Ethan Smith</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Company:        The Pennsylvania State University</span>
<span style="color: #9ca0a4;">;;;                 </span><span style="color: #9ca0a4;">Department of Computer Science and Engineering</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Program:        Generates waves (saw, triangle, and square), outputting them over serial.</span>
<span style="color: #9ca0a4;">;;;                 </span><span style="color: #9ca0a4;">a timer runs in the background</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Algorithm:      Command line interface. The user is presented with a command</span>
<span style="color: #9ca0a4;">;;;                 </span><span style="color: #9ca0a4;">prompt on which they can type.</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;;                 </span><span style="color: #9ca0a4;">when the user hits enter, their input is validated.</span>
<span style="color: #9ca0a4;">;;;                 </span><span style="color: #9ca0a4;">if the input is valid, then it is parsed and evaluated.</span>
<span style="color: #9ca0a4;">;;;                 </span><span style="color: #9ca0a4;">otherwise, the program returns an error.</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;;                 </span><span style="color: #9ca0a4;">the clock is run using the RTI interrupt, which increments a counter.</span>
<span style="color: #9ca0a4;">;;;                 </span><span style="color: #9ca0a4;">this counter is checked periodically, and when it is 400 (set lower for</span>
<span style="color: #9ca0a4;">;;;                 </span><span style="color: #9ca0a4;">sim purposes), 1 second has elapsed, and the seconds/minutes counters are</span>
<span style="color: #9ca0a4;">;;;                 </span><span style="color: #9ca0a4;">also updated.</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;;                 </span><span style="color: #9ca0a4;">the waves are generated using the oc5 interrupt. Depending on the type of wave</span>
<span style="color: #9ca0a4;">;;;                 </span><span style="color: #9ca0a4;">desired, there are 3 separate ISRs which will be set in the ISR jump vector when</span>
<span style="color: #9ca0a4;">;;;                 </span><span style="color: #9ca0a4;">the appropriate command is run.</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;;                 </span><span style="color: #9ca0a4;">the ADC command creates another interrupt routine on oc5 which</span>
<span style="color: #9ca0a4;">;;;                 </span><span style="color: #9ca0a4;">reads from the ADC channel 7, and transmits the data to the</span>
<span style="color: #9ca0a4;">;;;                 </span><span style="color: #9ca0a4;">terminal</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Register use:   Various usages depending on the subroutine.</span>
<span style="color: #9ca0a4;">;;;                 </span><span style="color: #9ca0a4;">typically, X is used as input buffer pointer.</span>
<span style="color: #9ca0a4;">;;;                 </span><span style="color: #9ca0a4;">D is typically used as the data pointer.</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;;                 </span><span style="color: #9ca0a4;">each subroutine defines stack variables which are used throughout</span>
<span style="color: #9ca0a4;">;;;                 </span><span style="color: #9ca0a4;">the subroutine.</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Memory use:     RAM Locations from $3000 for data,</span>
<span style="color: #9ca0a4;">;;;                 </span><span style="color: #9ca0a4;">RAM Locations after data for program</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;;                 </span><span style="color: #9ca0a4;">RAM Locations from program to 4100 for SP</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Observation:    Clock which counts up and loops around to 0:00 after 9:59</span>
<span style="color: #9ca0a4;">;;;                 </span><span style="color: #9ca0a4;">can be set via tty s command.</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;;                 </span><span style="color: #9ca0a4;">clock can be stopped with the quit command</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;;                 </span><span style="color: #9ca0a4;">wave generator works as expected, with the caveat that the clock is slowed down</span>
<span style="color: #9ca0a4;">;;;                 </span><span style="color: #9ca0a4;">while the wave is being generated, because the simulator slows down while printing.</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;;                 </span><span style="color: #9ca0a4;">adc command works as expected. ADC channel 7 is sampled at</span>
<span style="color: #9ca0a4;">;;;                 </span><span style="color: #9ca0a4;">8000Hz. it returns 2048 samples worth of data over the</span>
<span style="color: #9ca0a4;">;;;                 </span><span style="color: #9ca0a4;">serial output.</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Parameter Declearation Section</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Export Symbols</span>
            <span style="color: #e45649;">XDEF</span>        pstart       <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">export 'pstart' symbol</span>
            <span style="color: #e45649;">ABSENTRY</span>    pstart       <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">for assembly entry point</span>

<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Symbols and Macros</span>
<span style="color: #a626a4;">PORTA</span>       <span style="color: #e45649;">EQU</span>         $0000        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">i/o port A addresses</span>
<span style="color: #a626a4;">DDRA</span>        <span style="color: #e45649;">EQU</span>         $0002
<span style="color: #a626a4;">PORTB</span>       <span style="color: #e45649;">EQU</span>         $0001        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">i/o port B addresses</span>
<span style="color: #a626a4;">DDRB</span>        <span style="color: #e45649;">EQU</span>         $0003

<span style="color: #a626a4;">SCIBDH</span>      <span style="color: #e45649;">EQU</span>         $00C8        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">Serial port (SCI) Baud Register H</span>
<span style="color: #a626a4;">SCIBDL</span>      <span style="color: #e45649;">EQU</span>         $00C9        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">Serial port (SCI) Baud Register L</span>
<span style="color: #a626a4;">SCICR2</span>      <span style="color: #e45649;">EQU</span>         $00CB        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">Serial port (SCI) Control Register 2</span>
<span style="color: #a626a4;">SCISR1</span>      <span style="color: #e45649;">EQU</span>         $00CC        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">Serial port (SCI) Status Register 1</span>
<span style="color: #a626a4;">SCIDRL</span>      <span style="color: #e45649;">EQU</span>         $00CF        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">Serial port (SCI) Data Register</span>

<span style="color: #a626a4;">TIOS</span>        <span style="color: #e45649;">EQU</span>         $0040        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">Timer Input Capture (IC) or Output Compare (OC) select</span>
<span style="color: #a626a4;">TIE</span>         <span style="color: #e45649;">EQU</span>         $004C        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">Timer interrupt enable register</span>
<span style="color: #a626a4;">TCNTH</span>       <span style="color: #e45649;">EQU</span>         $0044        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">Timer free runing main counter</span>
<span style="color: #a626a4;">TSCR1</span>       <span style="color: #e45649;">EQU</span>         $0046        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">Timer system control 1</span>
<span style="color: #a626a4;">TSCR2</span>       <span style="color: #e45649;">EQU</span>         $004D        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">Timer system control 2</span>
<span style="color: #a626a4;">TFLG1</span>       <span style="color: #e45649;">EQU</span>         $004E        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">Timer interrupt flag 1</span>
<span style="color: #a626a4;">TC5H</span>        <span style="color: #e45649;">EQU</span>         $005A        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">Timer channel 5 register</span>

<span style="color: #a626a4;">CRGFLG</span>      <span style="color: #e45649;">EQU</span>         $0037        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">Clock and Reset Generator Flags</span>
<span style="color: #a626a4;">CRGINT</span>      <span style="color: #e45649;">EQU</span>         $0038        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">Clock and Reset Generator Interrupts</span>
<span style="color: #a626a4;">RTICTL</span>      <span style="color: #e45649;">EQU</span>         $003B        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">Real Time Interrupt Control</span>

<span style="color: #a626a4;">ATDCTL2</span>     <span style="color: #e45649;">EQU</span>  $0082               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">Analog-to-Digital Converter (ADC) registers</span>
<span style="color: #a626a4;">ATDCTL3</span>     <span style="color: #e45649;">EQU</span>  $0083
<span style="color: #a626a4;">ATDCTL4</span>     <span style="color: #e45649;">EQU</span>  $0084
<span style="color: #a626a4;">ATDCTL5</span>     <span style="color: #e45649;">EQU</span>  $0085
<span style="color: #a626a4;">ATDSTAT0</span>    <span style="color: #e45649;">EQU</span>  $0086
<span style="color: #a626a4;">ATDDR0H</span>     <span style="color: #e45649;">EQU</span>  $0090
<span style="color: #a626a4;">ATDDR0L</span>     <span style="color: #e45649;">EQU</span>  $0091
<span style="color: #a626a4;">ATDDR7H</span>     <span style="color: #e45649;">EQU</span>  $009e
<span style="color: #a626a4;">ATDDR7L</span>     <span style="color: #e45649;">EQU</span>  $009f

<span style="color: #a626a4;">BS</span>          <span style="color: #e45649;">equ</span>         $08          <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">backspace character</span>
<span style="color: #a626a4;">CR</span>          <span style="color: #e45649;">equ</span>         $0d          <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">carriage return, ASCII 'Return' key</span>
<span style="color: #a626a4;">LF</span>          <span style="color: #e45649;">equ</span>         $0a          <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">line feed, ASCII 'next line' character</span>
<span style="color: #a626a4;">NULL</span>        <span style="color: #e45649;">equ</span>         $00          <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">null terminator</span>

<span style="color: #a626a4;">DATAmax</span>     <span style="color: #e45649;">equ</span>         <span style="color: #50a14f;">2048</span>         <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">Data count maximum, 1024 constant</span>
<span style="color: #9ca0a4;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>

<span style="color: #9ca0a4;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Interrupt Vector Section</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">org     $3FF0               ; RTI interrupt vector setup for CSM-128 board</span>
            <span style="color: #e45649;">org</span>     $FFF0               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">RTI interrupt vector setup for the simulator</span>
            <span style="color: #e45649;">DC.W</span>    rtiisr              <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">place the address of the ISR at this location</span>

            <span style="color: #e45649;">ORG</span>     $FFE4       <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">Timer channel 5 interrupt vector setup, on simulator</span>
<span style="color: #a626a4;">oc5isr</span>      <span style="color: #e45649;">DC.W</span>    $0000
<span style="color: #9ca0a4;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>

<span style="color: #9ca0a4;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Data Section: address used [ $3000 to $30FF ] RAM memory</span>
            <span style="color: #e45649;">ORG</span>         $3000        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">Reserved RAM memory starting address</span>
                                     <span style="color: #9ca0a4;">;   </span><span style="color: #9ca0a4;">for Data for CMPEN 472 class</span>

<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">convenience string for sending newlines to terminal</span>
<span style="color: #a626a4;">NEWLINE</span>     <span style="color: #e45649;">DC.B</span>         CR, LF, NULL

<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">the menu which is printed when the program first starts</span>
<span style="color: #a626a4;">MENU</span>        <span style="color: #e45649;">DC.B</span>   <span style="color: #50a14f;">"Wave Generation Program"</span>, CR, LF
            <span style="color: #e45649;">DC.B</span>   <span style="color: #50a14f;">"use 'gw' to generate a sawtooth wave"</span>, CR, LF
            <span style="color: #e45649;">DC.B</span>   <span style="color: #50a14f;">"use 'gt' to generate a triangle wave"</span>, CR, LF
            <span style="color: #e45649;">DC.B</span>   <span style="color: #50a14f;">"use 'gq' to generate a square wave"</span>, CR, LF
            <span style="color: #e45649;">DC.B</span>   <span style="color: #50a14f;">"use 's M:SS' to set the current time"</span>, CR, LF
            <span style="color: #e45649;">DC.B</span>   <span style="color: #50a14f;">"use 'q' to quit the program and stop the clock"</span>, CR, LF, NULL

<span style="color: #a626a4;">PROMPT</span>      <span style="color: #e45649;">DC.B</span>   <span style="color: #50a14f;">"HW11&gt; "</span>, NULL
<span style="color: #a626a4;">QUIT_MSG</span>    <span style="color: #e45649;">DC.B</span>   <span style="color: #50a14f;">"Stopping Clock..."</span>, CR, LF
            <span style="color: #e45649;">DC.B</span>   <span style="color: #50a14f;">"Typewriter Program Started..."</span>, CR, LF, NULL

<span style="color: #a626a4;">BUFF_ERR</span>    <span style="color: #e45649;">DC.B</span>   <span style="color: #50a14f;">"Buffer Error"</span>, CR, LF, NULL
<span style="color: #a626a4;">FMT_ERR</span>     <span style="color: #e45649;">DC.B</span>   <span style="color: #50a14f;">"Format Error: proper format is 's M:SS'. M=[0,9] SS=[00,59]"</span>, CR, LF, NULL
<span style="color: #a626a4;">FMT_ERR2</span>    <span style="color: #e45649;">DC.B</span>   <span style="color: #50a14f;">"Format Error: you can only generate sawtooth (gw) triangle (gt) or square (gq) waves"</span>, CR, LF, NULL
<span style="color: #a626a4;">CMD_ERR</span>     <span style="color: #e45649;">DC.B</span>   <span style="color: #50a14f;">"Command Error: valid commands are"</span>, CR, LF
            <span style="color: #e45649;">DC.B</span>   <span style="color: #50a14f;">"                            's'  : set time"</span>, CR, LF
            <span style="color: #e45649;">DC.B</span>   <span style="color: #50a14f;">"                            'gw' : sawtooth wave generation"</span>, CR, LF
            <span style="color: #e45649;">DC.B</span>   <span style="color: #50a14f;">"                            'qt' : triangle wave generation"</span>, CR, LF
            <span style="color: #e45649;">DC.B</span>   <span style="color: #50a14f;">"                            'gq' : square wave generation"</span>, CR, LF
            <span style="color: #e45649;">DC.B</span>   <span style="color: #50a14f;">"                            'adc': get and print analog wave"</span>, CR, LF
            <span style="color: #e45649;">DC.B</span>   <span style="color: #50a14f;">"                            'q'  : quit"</span>, CR, LF, NULL

<span style="color: #a626a4;">msg3</span>        <span style="color: #e45649;">DC.B</span>   <span style="color: #50a14f;">"&gt; Be sure to start saving Terminal data: open Output file = RxData3.txt"</span>, CR, LF, NULL
<span style="color: #a626a4;">msg4</span>        <span style="color: #e45649;">DC.B</span>   <span style="color: #50a14f;">"&gt; press any key to continue..."</span>, CR, LF, CR, LF, NULL
<span style="color: #a626a4;">msg5</span>        <span style="color: #e45649;">DC.B</span>   <span style="color: #50a14f;">"&gt; Done!  Close Output file."</span>, CR, LF, NULL
<span style="color: #a626a4;">msg6</span>        <span style="color: #e45649;">DC.B</span>   <span style="color: #50a14f;">"&gt; Ready for next data transmission."</span>, CR, LF, NULL

<span style="color: #a626a4;">ctr125u</span>     <span style="color: #e45649;">DS.W</span>   <span style="color: #50a14f;">1</span>            <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">16bit interrupt counter for 125 uSec. of time</span>

<span style="color: #a626a4;">BUF</span>         <span style="color: #e45649;">DS.B</span>   <span style="color: #50a14f;">6</span>            <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">character buffer for a 16bit number in decimal ASCII</span>
<span style="color: #a626a4;">CTR</span>         <span style="color: #e45649;">DS.B</span>   <span style="color: #50a14f;">1</span>            <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">character buffer fill count</span>

<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">ADC variables</span>
<span style="color: #a626a4;">ATDdone</span>     <span style="color: #e45649;">DS.B</span>   <span style="color: #50a14f;">1</span>

<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">input and output string buffers</span>
<span style="color: #a626a4;">buffer</span>    <span style="color: #e45649;">DS</span>      <span style="color: #50a14f;">30</span>      <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">30 bytes for user input</span>

<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">global variables for the current time</span>
<span style="color: #a626a4;">timem</span>       <span style="color: #e45649;">DS.B</span>    <span style="color: #50a14f;">1</span>           <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">minute</span>
<span style="color: #a626a4;">times</span>       <span style="color: #e45649;">DS.B</span>    <span style="color: #50a14f;">1</span>           <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">second</span>

<span style="color: #a626a4;">ctr2p5m</span>     <span style="color: #e45649;">DS.W</span>    <span style="color: #50a14f;">1</span>           <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">interrupt counter for 2.5msec</span>
<span style="color: #9ca0a4;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>


<span style="color: #9ca0a4;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Program Section: address used [ end of DATA to $3FFF ] RAM memory</span>

<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">char* buffer;</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">while(true) {</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">update_leds();</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">print("Clock&gt; ");</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">read_line(buffer);  // get user input</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">eval_input(buffer); // send user input to eval subroutine</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">}</span>
<span style="color: #a626a4;">pstart</span>
    <span style="color: #e45649;">lds</span>     #$4100              <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">initialize stack pointer</span>

    <span style="color: #e45649;">ldaa</span>    #<span style="color: #6a1868;">%11111111</span>          <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">set all PORTA/B bits as output</span>
    <span style="color: #e45649;">staa</span>    DDRB                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">staa</span>    DDRA                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>

    <span style="color: #e45649;">ldaa</span>    #<span style="color: #6a1868;">%00000000</span>          <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">clear PORTA/B</span>
    <span style="color: #e45649;">staa</span>    PORTB               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">staa</span>    PORTA               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>

    <span style="color: #e45649;">ldaa</span>    #$0C         <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">Enable SCI port Tx and Rx units</span>
    <span style="color: #e45649;">staa</span>    SCICR2       <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">disable SCI interrupts</span>

    <span style="color: #e45649;">ldd</span>     #$0001       <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">Set SCI Baud Register = $0001 =&gt; 1.5M baud at 24MHz (for simulation)</span>
<span style="color: #9ca0a4;">;   </span><span style="color: #9ca0a4;">ldd     #$0002       ; Set SCI Baud Register = $0002 =&gt; 750K baud at 24MHz</span>
<span style="color: #9ca0a4;">;   </span><span style="color: #9ca0a4;">ldd     #$000D       ; Set SCI Baud Register = $000D =&gt; 115200 baud at 24MHz</span>
<span style="color: #9ca0a4;">;   </span><span style="color: #9ca0a4;">ldd     #$009C       ; Set SCI Baud Register = $009C =&gt; 9600 baud at 24MHz</span>
    <span style="color: #e45649;">std</span>     SCIBDH       <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">SCI port baud rate change</span>

    <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">RTI ISR configuration</span>
    <span style="color: #e45649;">bset</span>   RTICTL,<span style="color: #6a1868;">%00011001</span> <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">set RTI: dev=10*(2**10)=2.555msec for C128 board</span>
                            <span style="color: #9ca0a4;">;      </span><span style="color: #9ca0a4;">4MHz quartz oscillator clock</span>
    <span style="color: #e45649;">bset</span>   CRGINT,<span style="color: #6a1868;">%10000000</span> <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">enable RTI interrupt</span>
    <span style="color: #e45649;">bset</span>   CRGFLG,<span style="color: #6a1868;">%10000000</span> <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">clear RTI IF (Interrupt Flag)</span>

    <span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">ATD initialization</span>
    <span style="color: #e45649;">ldaa</span>    #<span style="color: #6a1868;">%11000000</span>       <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">Turn ON ADC, clear flags, Disable ATD interrupt</span>
    <span style="color: #e45649;">staa</span>    ATDCTL2
    <span style="color: #e45649;">ldaa</span>    #<span style="color: #6a1868;">%00001000</span>       <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">Single conversion per sequence, no FIFO</span>
    <span style="color: #e45649;">staa</span>    ATDCTL3
    <span style="color: #e45649;">ldaa</span>    #<span style="color: #6a1868;">%10000111</span>       <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">8bit, ADCLK=24MHz/16=1.5MHz, sampling time=2*(1/ADCLK)</span>
    <span style="color: #e45649;">staa</span>    ATDCTL4          <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">for SIMULATION</span>

    <span style="color: #e45649;">ldx</span>    #<span style="color: #50a14f;">0</span>
    <span style="color: #e45649;">stx</span>    ctr2p5m          <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">initialize interrupt counter with 0.</span>
    <span style="color: #e45649;">cli</span>                     <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">enable interrupt, global</span>

    <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">print the menu</span>
    <span style="color: #e45649;">ldx</span>     #MENU
    <span style="color: #e45649;">jsr</span>     print

    <span style="color: #e45649;">ldx</span>     #PROMPT
    <span style="color: #e45649;">jsr</span>     print

    <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">get user input and evaluate the command</span>
    <span style="color: #e45649;">ldx</span>     #buffer             <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">load input_buffer</span>

<span style="color: #a626a4;">looop</span>
    <span style="color: #e45649;">jsr</span>     update_LEDs      <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">make sure clock LEDs are updated</span>
    <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">prompt the user for a command</span>
    <span style="color: #e45649;">jsr</span>     getchar             <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">type writer - check the key board</span>
    <span style="color: #e45649;">cmpa</span>    #$00                <span style="color: #9ca0a4;">;  </span><span style="color: #9ca0a4;">if nothing typed, keep checking</span>
    <span style="color: #e45649;">beq</span>     looop

    <span style="color: #e45649;">cmpa</span>    #CR                 <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">was an enter typed?</span>
    <span style="color: #e45649;">beq</span>     on_enter            <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>

    <span style="color: #e45649;">cmpa</span>    #BS                 <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">| was a backspace typed?</span>
    <span style="color: #e45649;">beq</span>     on_backspace        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>

    <span style="color: #e45649;">cpx</span>     #buffer+<span style="color: #50a14f;">30</span>          <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">is there enough space in the input buffer?</span>
    <span style="color: #e45649;">bls</span>     append              <span style="color: #9ca0a4;">;  </span><span style="color: #9ca0a4;">if yes, append input to input buffer</span>

    <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">there is not enough space in the buffer, clear it (by reseting X)</span>
    <span style="color: #9ca0a4;">;;  </span><span style="color: #9ca0a4;">and report an error</span>
<span style="color: #a626a4;">clr_buf</span>
    <span style="color: #e45649;">ldx</span>     #NEWLINE            <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">print a newline</span>
    <span style="color: #e45649;">jsr</span>     print               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>

    <span style="color: #e45649;">ldx</span>     #BUFF_ERR           <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">print 'invalid command'</span>
    <span style="color: #e45649;">jsr</span>     print               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>

    <span style="color: #e45649;">ldx</span>     #NEWLINE            <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">print a newline</span>
    <span style="color: #e45649;">jsr</span>     print               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>

    <span style="color: #e45649;">ldx</span>     #PROMPT
    <span style="color: #e45649;">jsr</span>     print

    <span style="color: #e45649;">ldx</span>     #buffer             <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">reset input_buffer</span>
    <span style="color: #e45649;">bra</span>     looop               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">re-enter loop</span>


<span style="color: #a626a4;">append</span>
    <span style="color: #e45649;">staa</span>    <span style="color: #50a14f;">1</span>,X+                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">store the the typed character, and move the pointer</span>
    <span style="color: #e45649;">clr</span>     X                   <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">null terminate</span>

    <span style="color: #e45649;">jsr</span>     putchar             <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">display typed character in terminal</span>
    <span style="color: #e45649;">bra</span>     looop               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">get next character</span>

<span style="color: #a626a4;">on_enter</span>
    <span style="color: #e45649;">ldx</span>     #buffer             <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">set input for evaluate_cmd</span>

    <span style="color: #e45649;">ldaa</span>    X                   <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">if the user just pressed enter, without typing anything</span>
    <span style="color: #e45649;">cmpa</span>    #NULL               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">just print a new prompt (don't call evaluate)</span>
    <span style="color: #e45649;">beq</span>     blank_line          <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>

    <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">the user actually typed something</span>
    <span style="color: #e45649;">jsr</span>     eval                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">check the command</span>

<span style="color: #a626a4;">blank_line</span>
    <span style="color: #e45649;">ldx</span>     #NEWLINE            <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">print a newline</span>
    <span style="color: #e45649;">jsr</span>     print               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>

    <span style="color: #e45649;">ldx</span>     #PROMPT
    <span style="color: #e45649;">jsr</span>     print

    <span style="color: #e45649;">ldx</span>     #buffer             <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">reset input_buffer</span>
    <span style="color: #e45649;">clr</span>     X                   <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">NULL terminate beginning of input buffer to clear it.</span>

    <span style="color: #e45649;">bra</span>     looop               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">get next command</span>

<span style="color: #a626a4;">on_backspace</span>
    <span style="color: #e45649;">cpx</span>     #buffer             <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">ensure that there are characters to delete</span>
    <span style="color: #e45649;">beq</span>     looop               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">if there is nothing in the buffer, return to looop</span>

    <span style="color: #e45649;">clr</span>     <span style="color: #50a14f;">1</span>,-X                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">delete the last character, move pointer</span>
    <span style="color: #e45649;">pshx</span>                        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">store this value on stack so we can use X to print stuff</span>

    <span style="color: #e45649;">ldaa</span>    #LF                 <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">move cursor to beginning of line</span>
    <span style="color: #e45649;">jsr</span>     putchar             <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>

    <span style="color: #e45649;">ldx</span>     #PROMPT             <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">print as new prompt</span>
    <span style="color: #e45649;">jsr</span>     print               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>

    <span style="color: #e45649;">ldx</span>     #buffer             <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">print the input buffer</span>
    <span style="color: #e45649;">jsr</span>     print               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>

    <span style="color: #e45649;">pulx</span>                        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">restore current location of cursor in buffer</span>

    <span style="color: #e45649;">bra</span>     looop

<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">subroutine section below</span>

<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">eval</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Program:    validates input and executes the command</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Input:      X Register: buffer</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Algorithm:</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">checks if command is s or q. if not, then exit to command error.</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">if command is s:</span>
<span style="color: #9ca0a4;">;;;         </span><span style="color: #9ca0a4;">is the rest of the command in this format: M:SS? (where M is [0,9], S is [00,59])</span>
<span style="color: #9ca0a4;">;;;         </span><span style="color: #9ca0a4;">if so, then set the minutes and seconds variables.</span>
<span style="color: #9ca0a4;">;;;         </span><span style="color: #9ca0a4;">else, exit format error.</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">if command is q:</span>
<span style="color: #9ca0a4;">;;;         </span><span style="color: #9ca0a4;">check and make the buffer only contains q</span>
<span style="color: #9ca0a4;">;;;             </span><span style="color: #9ca0a4;">if not, exit command error</span>
<span style="color: #9ca0a4;">;;;             </span><span style="color: #9ca0a4;">else, print quit message, enter typewriter program</span>
<span style="color: #a626a4;">eval</span>
    <span style="color: #e45649;">pshx</span>
    <span style="color: #e45649;">pshy</span>
    <span style="color: #e45649;">psha</span>

    <span style="color: #e45649;">ldaa</span>    <span style="color: #50a14f;">1</span>,X+                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">A = command (every command is just one character)</span>
    <span style="color: #e45649;">cmpa</span>    #'s'                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">does command == 's'?</span>
    <span style="color: #e45649;">beq</span>     eval_set_time       <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">if so, validate and execute it.</span>

    <span style="color: #e45649;">cmpa</span>    #'g'                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">does command == 'g'?</span>
    <span style="color: #e45649;">beq</span>     eval_gen_sig        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">if so, validate and execute it.</span>

    <span style="color: #e45649;">cmpa</span>    #'a'                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">does command == 'a'?</span>
    <span style="color: #e45649;">lbeq</span>     eval_adc            <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">if so, see if it is 'adc'</span>

    <span style="color: #e45649;">cmpa</span>    #'q'                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">does command == 'q'?</span>
    <span style="color: #e45649;">lbeq</span>     eval_quit           <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">if so, validate and execute it.</span>

    <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">the command didn't match anything, so exit failure</span>
    <span style="color: #e45649;">lbra</span>     eval_exit_cmd_error

<span style="color: #a626a4;">eval_set_time</span>
    <span style="color: #e45649;">ldaa</span>    <span style="color: #50a14f;">1</span>,X+                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">is the input in the format of "s M:SS"?</span>
    <span style="color: #e45649;">cmpa</span>    #' '                <span style="color: #9ca0a4;">;    </span><span style="color: #9ca0a4;">if not, jump to exit_error</span>
    <span style="color: #e45649;">lbne</span>    eval_exit_error      <span style="color: #9ca0a4;">;    </span><span style="color: #9ca0a4;">else, continue</span>
                                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">ldaa</span>    <span style="color: #50a14f;">1</span>,X+                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">jsr</span>     is_dig              <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">lbne</span>     eval_exit_error     <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
                                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">ldaa</span>    <span style="color: #50a14f;">1</span>,X+                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">cmpa</span>    #':'                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">lbne</span>     eval_exit_error     <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
                                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">ldaa</span>    <span style="color: #50a14f;">1</span>,X+                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">jsr</span>     is_dig              <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">lbne</span>     eval_exit_error     <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
                                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">ldaa</span>    <span style="color: #50a14f;">1</span>,X+                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">jsr</span>     is_dig              <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">lbne</span>     eval_exit_error     <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
                                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">ldaa</span>    <span style="color: #50a14f;">1</span>,X+                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">cmpa</span>    #NULL               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">lbne</span>     eval_exit_error     <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>

    <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">at this point, we know the buffer is properly formatted</span>
    <span style="color: #e45649;">ldx</span>     <span style="color: #50a14f;">3</span>,SP                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">reset buffer pointer</span>
    <span style="color: #e45649;">leax</span>    <span style="color: #50a14f;">4</span>,X                 <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">load address of seconds number</span>
    <span style="color: #e45649;">jsr</span>     atoi                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">convert number at address from ascii to integer</span>

    <span style="color: #e45649;">cpd</span>     #<span style="color: #50a14f;">59</span>                 <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">if seconds &gt; 59 then:</span>
    <span style="color: #e45649;">lbhi</span>     eval_exit_error     <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">invalid time input, exit error</span>

    <span style="color: #e45649;">stab</span>    times               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">store lower 8 bits of output to seconds variable</span>

    <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">store the minutes now that we know the seconds are valid</span>
    <span style="color: #e45649;">ldx</span>     <span style="color: #50a14f;">3</span>,SP                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">reset buffer pointer</span>
    <span style="color: #e45649;">leax</span>    <span style="color: #50a14f;">2</span>,X                 <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">load address of first digit</span>
    <span style="color: #e45649;">ldaa</span>    X                   <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">A = first digit</span>
    <span style="color: #e45649;">suba</span>    #$30                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">Convert A from ascii to integer</span>

    <span style="color: #e45649;">staa</span>    timem               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">store to minutes variable</span>

    <span style="color: #e45649;">lbra</span>     eval_exit           <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">exit subroutine</span>

<span style="color: #a626a4;">eval_gen_sig</span>
    <span style="color: #e45649;">ldaa</span>    <span style="color: #50a14f;">1</span>,X+
    <span style="color: #e45649;">cmpa</span>    #'w'
    <span style="color: #e45649;">beq</span>     eval_sig_valid
    <span style="color: #e45649;">cmpa</span>    #'t'
    <span style="color: #e45649;">beq</span>     eval_sig_valid
    <span style="color: #e45649;">cmpa</span>    #'q'
    <span style="color: #e45649;">beq</span>     eval_sig_valid
    <span style="color: #e45649;">lbra</span>    eval_exit_error2

<span style="color: #a626a4;">eval_sig_valid</span>
    <span style="color: #e45649;">ldaa</span>    <span style="color: #50a14f;">1</span>,X-                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">move pointer back to the wave specifier</span>
    <span style="color: #e45649;">cmpa</span>    #NULL
    <span style="color: #e45649;">lbne</span>    eval_exit_error2    <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">exit error</span>
    <span style="color: #e45649;">tfr</span>     X,Y                 <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">Move X to Y, so X can be used for print</span>

    <span style="color: #e45649;">ldx</span>     #NEWLINE
    <span style="color: #e45649;">jsr</span>     print
    <span style="color: #e45649;">ldx</span>     #msg3
    <span style="color: #e45649;">jsr</span>     print
    <span style="color: #e45649;">ldx</span>     #msg4
    <span style="color: #e45649;">jsr</span>     print

<span style="color: #a626a4;">eval_sig_get_key</span>
    <span style="color: #e45649;">jsr</span>     update_LEDs
    <span style="color: #e45649;">jsr</span>     getchar
    <span style="color: #e45649;">cmpa</span>    #NULL
    <span style="color: #e45649;">beq</span>     eval_sig_get_key

    <span style="color: #e45649;">ldx</span>     #<span style="color: #50a14f;">0</span>                  <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">reset counter</span>
    <span style="color: #e45649;">stx</span>     ctr125u

    <span style="color: #e45649;">ldaa</span>    Y
    <span style="color: #e45649;">jsr</span>     StartTimer5oc

<span style="color: #a626a4;">loop2048</span>
    <span style="color: #e45649;">jsr</span>     update_LEDs      <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">make sure clock LEDs are updated</span>
    <span style="color: #e45649;">ldd</span>     ctr125u
    <span style="color: #e45649;">cpd</span>     #DATAmax         <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">1024 bytes will be sent, the receiver at Windows PC</span>
    <span style="color: #e45649;">bhs</span>     loopTxON         <span style="color: #9ca0a4;">;   </span><span style="color: #9ca0a4;">will only take 2048 bytes.</span>
    <span style="color: #e45649;">bra</span>     loop2048         <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">set Terminal Cache Size to 10000 lines, update from 1000 lines</span>

<span style="color: #a626a4;">loopTxON</span>
    <span style="color: #e45649;">LDAA</span>    #<span style="color: #6a1868;">%00000000</span>
    <span style="color: #e45649;">STAA</span>    TIE               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">disable OC5 interrupt</span>

    <span style="color: #e45649;">ldx</span>     #NEWLINE
    <span style="color: #e45649;">jsr</span>     print
    <span style="color: #e45649;">jsr</span>     print

    <span style="color: #e45649;">ldx</span>     #msg5            <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">print '&gt; Done!  Close Output file.'</span>
    <span style="color: #e45649;">jsr</span>     print

    <span style="color: #e45649;">ldx</span>     #msg6            <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">print '&gt; Ready for next data transmission'</span>
    <span style="color: #e45649;">jsr</span>     print

    <span style="color: #e45649;">ldx</span>     #NEWLINE
    <span style="color: #e45649;">jsr</span>     print

    <span style="color: #e45649;">bra</span>     eval_exit

<span style="color: #a626a4;">eval_adc</span>
    <span style="color: #e45649;">ldaa</span>    <span style="color: #50a14f;">1</span>,X+
    <span style="color: #e45649;">cmpa</span>    #'d'
    <span style="color: #e45649;">bne</span>     eval_exit_cmd_error

    <span style="color: #e45649;">ldaa</span>    <span style="color: #50a14f;">1</span>,X+
    <span style="color: #e45649;">cmpa</span>    #'c'
    <span style="color: #e45649;">bne</span>     eval_exit_cmd_error

    <span style="color: #e45649;">ldaa</span>    <span style="color: #50a14f;">1</span>,X+
    <span style="color: #e45649;">cmpa</span>    #NULL
    <span style="color: #e45649;">bne</span>     eval_exit_cmd_error

    <span style="color: #e45649;">ldx</span>     #NEWLINE
    <span style="color: #e45649;">jsr</span>     print
    <span style="color: #e45649;">jsr</span>     print

<span style="color: #a626a4;">eval_adc_get_key</span>
    <span style="color: #e45649;">jsr</span>     update_LEDs
    <span style="color: #e45649;">jsr</span>     getchar
    <span style="color: #e45649;">cmpa</span>    #NULL
    <span style="color: #e45649;">beq</span>     eval_adc_get_key

    <span style="color: #e45649;">ldx</span>     #<span style="color: #50a14f;">0</span>                  <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">reset counter</span>
    <span style="color: #e45649;">stx</span>     ctr125u

    <span style="color: #e45649;">ldx</span>     #NEWLINE
    <span style="color: #e45649;">jsr</span>     print

    <span style="color: #e45649;">ldaa</span>    #'a'
    <span style="color: #e45649;">jsr</span>     StartTimer5oc
    <span style="color: #e45649;">bra</span>     loop2048

<span style="color: #a626a4;">eval_quit</span>
    <span style="color: #e45649;">ldaa</span>    X
    <span style="color: #e45649;">cmpa</span>    #NULL
    <span style="color: #e45649;">bne</span>     eval_exit_cmd_error

    <span style="color: #e45649;">sei</span>                         <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">disable interrupts, thus stopping the clock</span>

    <span style="color: #e45649;">ldx</span>     #NEWLINE            <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">print quit message</span>
    <span style="color: #e45649;">jsr</span>     print               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">ldx</span>     #QUIT_MSG           <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">jsr</span>     print               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>

    <span style="color: #e45649;">jsr</span>     typewriter          <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">enter typewriter program</span>

<span style="color: #a626a4;">eval_exit_error</span>
    <span style="color: #e45649;">ldx</span>     #NEWLINE            <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">print a newline, then the error message</span>
    <span style="color: #e45649;">jsr</span>     print               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">ldx</span>     #FMT_ERR            <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">jsr</span>     print               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">bra</span>     eval_exit           <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>

<span style="color: #a626a4;">eval_exit_error2</span>
    <span style="color: #e45649;">ldx</span>     #NEWLINE            <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">print a newline, then the error message</span>
    <span style="color: #e45649;">jsr</span>     print               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">ldx</span>     #FMT_ERR2           <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">jsr</span>     print               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">bra</span>     eval_exit           <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>

<span style="color: #a626a4;">eval_exit_cmd_error</span>
    <span style="color: #e45649;">ldx</span>     #NEWLINE            <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">print a newline, then the error message</span>
    <span style="color: #e45649;">jsr</span>     print               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">ldx</span>     #CMD_ERR            <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">jsr</span>     print               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>

<span style="color: #a626a4;">eval_exit</span>
    <span style="color: #e45649;">pula</span>
    <span style="color: #e45649;">puly</span>
    <span style="color: #e45649;">pulx</span>

    <span style="color: #e45649;">rts</span>
<span style="color: #9ca0a4;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>

<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">***********Timer OC5 interrupt service routine***************</span>
<span style="color: #a626a4;">oc5isr_saw</span>
    <span style="color: #e45649;">ldd</span>     #<span style="color: #50a14f;">3000</span>              <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">125usec with (24MHz/1 clock)</span>
    <span style="color: #e45649;">addd</span>    TC5H               <span style="color: #9ca0a4;">;    </span><span style="color: #9ca0a4;">for next interrupt</span>
    <span style="color: #e45649;">std</span>     TC5H               <span style="color: #9ca0a4;">;</span>
    <span style="color: #e45649;">bset</span>    TFLG1,<span style="color: #6a1868;">%00100000</span>    <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">clear timer CH6 interrupt flag, not needed if fast clear enabled</span>
    <span style="color: #e45649;">ldd</span>     ctr125u
    <span style="color: #e45649;">ldx</span>     ctr125u
    <span style="color: #e45649;">inx</span>                        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">update OC5 (125usec) interrupt counter</span>
    <span style="color: #e45649;">stx</span>     ctr125u
    <span style="color: #e45649;">clra</span>                       <span style="color: #9ca0a4;">;   </span><span style="color: #9ca0a4;">print ctr125u, only the last byte</span>
    <span style="color: #e45649;">jsr</span>     pnum10             <span style="color: #9ca0a4;">;   </span><span style="color: #9ca0a4;">to make the file RxData3.txt with exactly 1024 data</span>
    <span style="color: #e45649;">RTI</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">***********end of Timer OC5 interrupt service routine********</span>

<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">Timer OC5 interrupt service routine***************</span>
<span style="color: #a626a4;">oc5isr_tri</span>
    <span style="color: #e45649;">ldd</span>     #<span style="color: #50a14f;">3000</span>              <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">125usec with (24MHz/1 clock)</span>
    <span style="color: #e45649;">addd</span>    TC5H               <span style="color: #9ca0a4;">;    </span><span style="color: #9ca0a4;">for next interrupt</span>
    <span style="color: #e45649;">std</span>     TC5H               <span style="color: #9ca0a4;">;</span>
    <span style="color: #e45649;">bset</span>    TFLG1,<span style="color: #6a1868;">%00100000</span>    <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">clear timer CH6 interrupt flag, not needed if fast clear enabled</span>
    <span style="color: #e45649;">ldd</span>     ctr125u
    <span style="color: #e45649;">ldx</span>     ctr125u
    <span style="color: #e45649;">inx</span>                        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">update OC5 (125usec) interrupt counter</span>
    <span style="color: #e45649;">stx</span>     ctr125u


    <span style="color: #e45649;">anda</span>    #<span style="color: #6a1868;">%00000001</span>          <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">if lsb is 1, countdown</span>
    <span style="color: #e45649;">bne</span>     tri_countdown       <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">else, countup</span>
    <span style="color: #e45649;">bra</span>     tri_countup

<span style="color: #a626a4;">tri_countdown</span>
    <span style="color: #e45649;">ldaa</span>    #$FF                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">do 255 - B</span>
    <span style="color: #e45649;">sba</span>                         <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">result is stored in A,</span>
    <span style="color: #e45649;">tab</span>                         <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">so move it to B</span>
    <span style="color: #e45649;">bra</span>     tri_exit

<span style="color: #a626a4;">tri_countup</span>

<span style="color: #a626a4;">tri_exit</span>
    <span style="color: #e45649;">clra</span>
    <span style="color: #e45649;">jsr</span>   pnum10             <span style="color: #9ca0a4;">;   </span><span style="color: #9ca0a4;">to make the file RxData3.txt with exactly 1024 data</span>
    <span style="color: #e45649;">rti</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">***********end of Timer OC5 interrupt service routine********</span>

<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">Timer OC5 interrupt service routine***************</span>
<span style="color: #a626a4;">oc5isr_square</span>
    <span style="color: #e45649;">ldd</span>     #<span style="color: #50a14f;">3000</span>              <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">125usec with (24MHz/1 clock)</span>
    <span style="color: #e45649;">addd</span>    TC5H               <span style="color: #9ca0a4;">;    </span><span style="color: #9ca0a4;">for next interrupt</span>
    <span style="color: #e45649;">std</span>     TC5H               <span style="color: #9ca0a4;">;</span>
    <span style="color: #e45649;">bset</span>    TFLG1,<span style="color: #6a1868;">%00100000</span>    <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">clear timer CH6 interrupt flag, not needed if fast clear enabled</span>
    <span style="color: #e45649;">ldd</span>     ctr125u
    <span style="color: #e45649;">ldx</span>     ctr125u
    <span style="color: #e45649;">inx</span>                        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">update OC5 (125usec) interrupt counter</span>
    <span style="color: #e45649;">stx</span>     ctr125u

    <span style="color: #e45649;">anda</span>    #<span style="color: #6a1868;">%00000001</span>          <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">if lsb is 1, hi</span>
    <span style="color: #e45649;">bne</span>     square_hi           <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">else, low</span>
    <span style="color: #e45649;">bra</span>     square_lo

<span style="color: #a626a4;">square_hi</span>
    <span style="color: #e45649;">ldab</span>    #$FF
    <span style="color: #e45649;">bra</span>     square_exit
<span style="color: #a626a4;">square_lo</span>
    <span style="color: #e45649;">ldab</span>    #<span style="color: #50a14f;">0</span>

<span style="color: #a626a4;">square_exit</span>
    <span style="color: #e45649;">clra</span>                     <span style="color: #9ca0a4;">;   </span><span style="color: #9ca0a4;">print ctr125u, only the last byte</span>
    <span style="color: #e45649;">jsr</span>     pnum10             <span style="color: #9ca0a4;">;   </span><span style="color: #9ca0a4;">to make the file RxData3.txt with exactly 1024 data</span>
    <span style="color: #e45649;">RTI</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">***********end of Timer OC5 interrupt service routine********</span>

<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">Timer OC5 interrupt service routine***************</span>
<span style="color: #a626a4;">oc5isr_adc</span>
    <span style="color: #e45649;">ldd</span>     #<span style="color: #50a14f;">3000</span>              <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">125usec with (24MHz/1 clock)</span>
    <span style="color: #e45649;">addd</span>    TC5H               <span style="color: #9ca0a4;">;    </span><span style="color: #9ca0a4;">for next interrupt</span>
    <span style="color: #e45649;">std</span>     TC5H               <span style="color: #9ca0a4;">;</span>
    <span style="color: #e45649;">bset</span>    TFLG1,<span style="color: #6a1868;">%00100000</span>    <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">clear timer CH6 interrupt flag, not needed if fast clear enabled</span>
    <span style="color: #e45649;">ldx</span>     ctr125u
    <span style="color: #e45649;">inx</span>                        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">update OC5 (125usec) interrupt counter</span>
    <span style="color: #e45649;">stx</span>     ctr125u

<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">adcwait</span>
<span style="color: #9ca0a4;">;    </span><span style="color: #9ca0a4;">ldaa    ATDSTAT0            ; if necessary, wait until conversion is done.</span>
<span style="color: #9ca0a4;">;    </span><span style="color: #9ca0a4;">anda    #%10000000</span>
<span style="color: #9ca0a4;">;    </span><span style="color: #9ca0a4;">beq     adcwait</span>

    <span style="color: #e45649;">ldab</span>    ATDDR0L            <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">get number from adc</span>
    <span style="color: #e45649;">clra</span>
    <span style="color: #e45649;">jsr</span>     pnum10             <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">print number from adc</span>

    <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">start another conversion</span>
    <span style="color: #e45649;">ldaa</span>    #<span style="color: #6a1868;">%10000111</span>       <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">right justified, unsigned, single conversion,</span>
    <span style="color: #e45649;">staa</span>    ATDCTL5          <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">single channel, CHANNEL 7, start the conversion</span>
    <span style="color: #e45649;">RTI</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">***********end of Timer OC5 interrupt service routine********</span>

<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">***************StartTimer5oc************************</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Program: Start the timer interrupt, timer channel 6 output compare</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Input:   A Register: ascii code for type of signal</span>
<span style="color: #9ca0a4;">;           </span><span style="color: #9ca0a4;">Constants - channel 6 output compare, 125usec at 24MHz</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Output:  None, only the timer interrupt</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Registers modified: D used and CCR modified</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Algorithm:</span>
<span style="color: #9ca0a4;">;             </span><span style="color: #9ca0a4;">initialize TIOS, TIE, TSCR1, TSCR2, TC2H, and TFLG1</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">**********************************************</span>
<span style="color: #a626a4;">StartTimer5oc</span>
    <span style="color: #e45649;">pshd</span>
    <span style="color: #e45649;">pshx</span>

    <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">set appropriate interrupt vector</span>
    <span style="color: #e45649;">cmpa</span>    #'w'
    <span style="color: #e45649;">beq</span>     saw5oc
    <span style="color: #e45649;">cmpa</span>    #'t'
    <span style="color: #e45649;">beq</span>     triangle5oc
    <span style="color: #e45649;">cmpa</span>    #'q'
    <span style="color: #e45649;">beq</span>     square5oc
    <span style="color: #e45649;">cmpa</span>    #'a'
    <span style="color: #e45649;">beq</span>     adc5oc

<span style="color: #a626a4;">saw5oc</span>
    <span style="color: #e45649;">ldx</span>     #oc5isr_saw
    <span style="color: #e45649;">bra</span>     store5oc
<span style="color: #a626a4;">triangle5oc</span>
    <span style="color: #e45649;">ldx</span>     #oc5isr_tri
    <span style="color: #e45649;">bra</span>     store5oc
<span style="color: #a626a4;">square5oc</span>
    <span style="color: #e45649;">ldx</span>     #oc5isr_square
    <span style="color: #e45649;">bra</span>     store5oc
<span style="color: #a626a4;">adc5oc</span>
    <span style="color: #e45649;">ldx</span>     #oc5isr_adc


<span style="color: #a626a4;">store5oc</span>
    <span style="color: #e45649;">stx</span>     oc5isr

    <span style="color: #e45649;">ldaa</span>    #<span style="color: #6a1868;">%00100000</span>
    <span style="color: #e45649;">staa</span>    TIOS              <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">set CH5 Output Compare</span>
    <span style="color: #e45649;">staa</span>    TIE               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">set CH5 interrupt Enable</span>
    <span style="color: #e45649;">ldaa</span>    #<span style="color: #6a1868;">%10000000</span>        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">enable timer, Fast Flag Clear not set</span>
    <span style="color: #e45649;">staa</span>    TSCR1
    <span style="color: #e45649;">ldaa</span>    #<span style="color: #6a1868;">%00000000</span>        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">TOI Off, TCRE Off, TCLK = BCLK/1</span>
    <span style="color: #e45649;">staa</span>    TSCR2             <span style="color: #9ca0a4;">;   </span><span style="color: #9ca0a4;">not needed if started from reset</span>

    <span style="color: #e45649;">ldd</span>     #<span style="color: #50a14f;">3000</span>            <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">125usec with (24MHz/1 clock)</span>
    <span style="color: #e45649;">addd</span>    TCNTH            <span style="color: #9ca0a4;">;    </span><span style="color: #9ca0a4;">for first interrupt</span>
    <span style="color: #e45649;">std</span>     TC5H             <span style="color: #9ca0a4;">;</span>

    <span style="color: #e45649;">bset</span>    TFLG1,<span style="color: #6a1868;">%00100000</span>   <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">initial Timer CH5 interrupt flag Clear, not needed if fast clear set</span>
    <span style="color: #e45649;">ldaa</span>    #<span style="color: #6a1868;">%00100000</span>
    <span style="color: #e45649;">staa</span>    TIE               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">set CH5 interrupt Enable</span>

    <span style="color: #e45649;">pulx</span>
    <span style="color: #e45649;">puld</span>
    <span style="color: #e45649;">rts</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">***************end of StartTimer2oc*****************</span>


<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">***********pnum10***************************</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Program: print a word (16bit) in decimal to SCI port</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Input:   Register D contains a 16 bit number to print in decimal number</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Output:  decimal number printed on the terminal connected to SCI port</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">*</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Registers modified: CCR</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">* Algorithm:</span>
<span style="color: #9ca0a4;">;     </span><span style="color: #9ca0a4;">Keep divide number by 10 and keep the remainders</span>
<span style="color: #9ca0a4;">;     </span><span style="color: #9ca0a4;">Then send it out to SCI port</span>
<span style="color: #9ca0a4;">;  </span><span style="color: #9ca0a4;">Need memory location for counter CTR and buffer BUF(6 byte max)</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">**********************************************</span>
<span style="color: #a626a4;">pnum10</span>          <span style="color: #e45649;">pshd</span>                   <span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">Save registers</span>
                <span style="color: #e45649;">pshx</span>
                <span style="color: #e45649;">pshy</span>
                <span style="color: #e45649;">clr</span>     CTR            <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">clear character count of an 8 bit number</span>

                <span style="color: #e45649;">ldy</span>     #BUF
<span style="color: #a626a4;">pnum10p1</span>        <span style="color: #e45649;">ldx</span>     #<span style="color: #50a14f;">10</span>
                <span style="color: #e45649;">idiv</span>
                <span style="color: #e45649;">beq</span>     pnum10p2
                <span style="color: #e45649;">stab</span>    <span style="color: #50a14f;">1</span>,y+
                <span style="color: #e45649;">inc</span>     CTR
                <span style="color: #e45649;">tfr</span>     x,d
                <span style="color: #e45649;">bra</span>     pnum10p1

<span style="color: #a626a4;">pnum10p2</span>        <span style="color: #e45649;">stab</span>    <span style="color: #50a14f;">1</span>,y+
                <span style="color: #e45649;">inc</span>     CTR
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">--------------------------------------</span>

<span style="color: #a626a4;">pnum10p3</span>        <span style="color: #e45649;">ldaa</span>    #$30
                <span style="color: #e45649;">adda</span>    <span style="color: #50a14f;">1</span>,-y
                <span style="color: #e45649;">jsr</span>     putchar
                <span style="color: #e45649;">dec</span>     CTR
                <span style="color: #e45649;">bne</span>     pnum10p3
                <span style="color: #e45649;">ldx</span>     #NEWLINE
                <span style="color: #e45649;">jsr</span>     print
                <span style="color: #e45649;">puly</span>
                <span style="color: #e45649;">pulx</span>
                <span style="color: #e45649;">puld</span>
                <span style="color: #e45649;">rts</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">***********end of pnum10********************</span>

<span style="color: #9ca0a4;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">typewriter</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Program:    simple echo program which sends user input back to the terminal</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Input:      None</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Output:     None, doesn't ever return to main loop</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Algorithm:</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">gets character from terminal</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">sends character back to terminal.</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">if newline is recieved, a linefeed is also sent to terminal</span>
<span style="color: #a626a4;">typewriter</span>
    <span style="color: #e45649;">jsr</span>     getchar
    <span style="color: #e45649;">jsr</span>     putchar

    <span style="color: #e45649;">cmpa</span>    #CR
    <span style="color: #e45649;">bne</span>     typewriter

<span style="color: #a626a4;">typewriter_onenter</span>
    <span style="color: #e45649;">ldaa</span>    #LF
    <span style="color: #e45649;">jsr</span>     putchar
    <span style="color: #e45649;">bra</span>     typewriter

<span style="color: #9ca0a4;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">update_LEDs</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Program:    convert integer to binary coded decimal, and update PORTA/PORTB with minutes and seconds.</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Input:      None. uses global minutes and seconds counters</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Ouput:      Modifies PORTA and PORTB</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Algorithm:</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">values are stored as integers. minutes is easy, just store it at PORTA</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">for PORTB, first it is divided by 10. the remainder is the 1's place,</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">quotient is the 10's place.</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">the 1's digit is stored in the temp variable. then the 10's digit is shifted.</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">they are or'ed together</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">the result is stored in PORTB</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #50a14f; font-weight: bold;">NOTE:</span><span style="color: #9ca0a4;"> A temp variable isn't needed, but if PORTB is used directly, then the simulator</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">will flicker the seconds 10's place digit (this wouldn't be visible in real life).</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">a temp variable is used soley for the simulator.</span>
<span style="color: #a626a4;">update_LEDs</span>
    <span style="color: #e45649;">pshd</span>
    <span style="color: #e45649;">pshx</span>
    <span style="color: #e45649;">clr</span>     <span style="color: #50a14f;">1</span>,-SP               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">temp variable</span>

    <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">does the time need updated?</span>
    <span style="color: #e45649;">ldd</span>     ctr2p5m             <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">check the 2.5ms counter, has 1000ms elapsed?</span>
    <span style="color: #e45649;">cpd</span>     #<span style="color: #50a14f;">150</span>                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">| (ie, counter == 400)</span>
    <span style="color: #e45649;">bls</span>     update_LEDs_skip    <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">| (for sim purposes, this value is set to 150)</span>

    <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">the counter</span>
    <span style="color: #e45649;">clr</span>     ctr2p5m             <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">clear (BOTH BYTES) of the counter</span>
    <span style="color: #e45649;">clr</span>     ctr2p5m+<span style="color: #50a14f;">1</span>           <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">inc</span>     times               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">increment the seconds counter</span>

    <span style="color: #e45649;">ldaa</span>    times               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">is the seconds counter == 60?</span>
    <span style="color: #e45649;">cmpa</span>    #<span style="color: #50a14f;">60</span>                 <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">blo</span>     update_LEDs_skip    <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>

    <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">seconds counter == 60</span>
    <span style="color: #e45649;">clr</span>     times               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">reset the seconds counter</span>
    <span style="color: #e45649;">inc</span>     timem               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">increment the minutes counter</span>

    <span style="color: #e45649;">ldaa</span>    timem               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">is the minutes counter == 10?</span>
    <span style="color: #e45649;">cmpa</span>    #<span style="color: #50a14f;">10</span>                 <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">blo</span>     update_LEDs_skip    <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>

    <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">minutes counter == 10</span>
    <span style="color: #e45649;">clr</span>     timem               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">reset minutes counter back to 0</span>

<span style="color: #a626a4;">update_LEDs_skip</span>

    <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">do first divide (for 1's digit)</span>
    <span style="color: #e45649;">ldab</span>    times               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">set dividend (total num of seconds)</span>
    <span style="color: #e45649;">clra</span>                        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">ensure A is zero for divide</span>
    <span style="color: #e45649;">ldx</span>     #<span style="color: #50a14f;">10</span>                 <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">set divisor</span>
    <span style="color: #e45649;">idiv</span>

    <span style="color: #e45649;">stab</span>    SP                  <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">stash 1's digit on temp variable</span>

    <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">10's digit is now in X register</span>
    <span style="color: #e45649;">tfr</span>     X,D                 <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">move from X to D (low-4 will be in B register)</span>

    <span style="color: #e45649;">lslb</span>                        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">move digit to upper four bits</span>
    <span style="color: #e45649;">lslb</span>                        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">lslb</span>                        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">lslb</span>                        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>

    <span style="color: #e45649;">orab</span>    SP                  <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">combine 10's and 1's in PORTB</span>
    <span style="color: #e45649;">stab</span>    PORTB               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">store value to PORTB</span>

    <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">send result out to ports</span>
    <span style="color: #e45649;">ldaa</span>    timem
    <span style="color: #e45649;">staa</span>    PORTA

    <span style="color: #e45649;">leas</span>    <span style="color: #50a14f;">1</span>,SP                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">pop off temp variable</span>
    <span style="color: #e45649;">pulx</span>
    <span style="color: #e45649;">puld</span>
    <span style="color: #e45649;">rts</span>

<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">atoi</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Program:    converts a string to an integer (if possible)</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Input:      X Register: pointer to string</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Output:     D Register: integer representation of string</span>
<span style="color: #9ca0a4;">;;;             </span><span style="color: #9ca0a4;">modifies err_flag and err_data</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Algorithm:</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">converts digits up to first non-number character.</span>
<span style="color: #9ca0a4;">;;;      </span><span style="color: #9ca0a4;">e.g. atoi("12hey there") -&gt; 12</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">if the first character is a non-number, D is set to zero</span>
<span style="color: #9ca0a4;">;;;      </span><span style="color: #9ca0a4;">and err_flag and err_data are set accordingly</span>
<span style="color: #9ca0a4;">;;;      </span><span style="color: #9ca0a4;">e.g. atoi("afs12") -&gt; 0 (ERROR)</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">Stack Layout:</span>
<span style="color: #9ca0a4;">;;;         </span><span style="color: #9ca0a4;">SP + 8: return address</span>
<span style="color: #9ca0a4;">;;;         </span><span style="color: #9ca0a4;">SP + 6: X reg</span>
<span style="color: #9ca0a4;">;;;         </span><span style="color: #9ca0a4;">SP + 5: len var</span>
<span style="color: #9ca0a4;">;;;         </span><span style="color: #9ca0a4;">SP + 4: pow var</span>
<span style="color: #9ca0a4;">;;;         </span><span style="color: #9ca0a4;">SP + 2: tmp var</span>
<span style="color: #9ca0a4;">;;;         </span><span style="color: #9ca0a4;">SP + 0: accum var</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">// find length of number</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">len = 0 ; length accumulator</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">while is_digit((X++)*):</span>
<span style="color: #9ca0a4;">;;;         </span><span style="color: #9ca0a4;">len++;</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">// add up each digit</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">index = len; // len is now index for X</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">accum = A; store A on the stack</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">pow = 0; // power variable</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">B = 1 ; // B is now the Power Accumulator</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">X = index+X ; we are going through this number backwards</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">while index &gt; 0:</span>
<span style="color: #9ca0a4;">;;;         </span><span style="color: #9ca0a4;">index--;</span>
<span style="color: #9ca0a4;">;;;         </span><span style="color: #9ca0a4;">pow = index;</span>
<span style="color: #9ca0a4;">;;;         </span><span style="color: #9ca0a4;">D = X[-index];</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;;         </span><span style="color: #9ca0a4;">if pow == 0:</span>
<span style="color: #9ca0a4;">;;;             </span><span style="color: #9ca0a4;">accum += D</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;;         </span><span style="color: #9ca0a4;">tmp = D</span>
<span style="color: #9ca0a4;">;;;         </span><span style="color: #9ca0a4;">while pow &gt; 0:</span>
<span style="color: #9ca0a4;">;;;             </span><span style="color: #9ca0a4;">tmp += tmp &lt;&lt; 3</span>
<span style="color: #9ca0a4;">;;;             </span><span style="color: #9ca0a4;">tmp += tmp &lt;&lt; 1</span>
<span style="color: #9ca0a4;">;;;             </span><span style="color: #9ca0a4;">pow--;</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;;         </span><span style="color: #9ca0a4;">accum += tmp</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span style="color: #a626a4;">atoi</span>
    <span style="color: #e45649;">pshy</span>
    <span style="color: #e45649;">pshx</span>
    <span style="color: #e45649;">clr</span>     <span style="color: #50a14f;">1</span>,-SP               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">len var / index var</span>
    <span style="color: #e45649;">clr</span>     <span style="color: #50a14f;">1</span>,-SP               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">pow var</span>
    <span style="color: #e45649;">clr</span>     <span style="color: #50a14f;">1</span>,-SP               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">tmp var</span>
    <span style="color: #e45649;">clr</span>     <span style="color: #50a14f;">1</span>,-SP               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">clr</span>     <span style="color: #50a14f;">1</span>,-SP               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">accum var</span>
    <span style="color: #e45649;">clr</span>     <span style="color: #50a14f;">1</span>,-SP               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>

<span style="color: #a626a4;">atoi_getlen</span>
    <span style="color: #e45649;">ldaa</span>    <span style="color: #50a14f;">1</span>,X+                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">get next character</span>
    <span style="color: #e45649;">jsr</span>     is_dig              <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">break if character != number</span>
    <span style="color: #e45649;">bne</span>     atoi_getlen_exit    <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>

    <span style="color: #e45649;">inc</span>     <span style="color: #50a14f;">5</span>,SP                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">increment length</span>
    <span style="color: #e45649;">bra</span>     atoi_getlen         <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">continue</span>

<span style="color: #a626a4;">atoi_getlen_exit</span>
    <span style="color: #e45649;">ldx</span>     <span style="color: #50a14f;">6</span>,SP                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">reload x from stack</span>
    <span style="color: #e45649;">dex</span>                         <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">keep X from being incremented prematurely.</span>
<span style="color: #a626a4;">atoi_accumulate</span>
    <span style="color: #e45649;">ldaa</span>    <span style="color: #50a14f;">5</span>,SP                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">if index == 0, break</span>
    <span style="color: #e45649;">cmpa</span>    #<span style="color: #50a14f;">0</span>                  <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">beq</span>     atoi_exit           <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">dec</span>     <span style="color: #50a14f;">5</span>,SP                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">decrement index</span>
    <span style="color: #e45649;">deca</span>                        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">decrement register to track</span>
    <span style="color: #e45649;">inx</span>                         <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">decrement pointer</span>

    <span style="color: #e45649;">movb</span>    <span style="color: #50a14f;">5</span>,SP, <span style="color: #50a14f;">4</span>,SP          <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">pow = index</span>

    <span style="color: #e45649;">cmpa</span>    #<span style="color: #50a14f;">0</span>                  <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">if pow &gt; 0, skip special handling</span>
    <span style="color: #e45649;">bne</span>     atoi_calc_power     <span style="color: #9ca0a4;">;</span>

    <span style="color: #e45649;">clra</span>                        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">clear A register</span>
    <span style="color: #e45649;">ldab</span>     X                  <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">load lower 8 bits to B</span>
    <span style="color: #e45649;">subb</span>    #$30                 <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">convert from ascii</span>
    <span style="color: #e45649;">addd</span>    SP                  <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">D += accum</span>
    <span style="color: #e45649;">std</span>     SP                  <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">accum = D</span>
    <span style="color: #e45649;">bra</span>     atoi_exit           <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">at this point, loop is finished</span>

    <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">because of the previous if statement, we know that index and power</span>
    <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">will always be at least 1</span>
<span style="color: #a626a4;">atoi_calc_power</span>
    <span style="color: #e45649;">clra</span>
    <span style="color: #e45649;">ldab</span>    X                   <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">load lower 8 bits to B</span>
    <span style="color: #e45649;">subb</span>    #$30                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">convert from ascii</span>

    <span style="color: #e45649;">std</span>     <span style="color: #50a14f;">2</span>,SP                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">store in tmp</span>
<span style="color: #a626a4;">atoi_calc_power_lp</span>
    <span style="color: #e45649;">ldaa</span>    <span style="color: #50a14f;">4</span>,SP                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">if pow = 0, break</span>
    <span style="color: #e45649;">cmpa</span>    #<span style="color: #50a14f;">0</span>                  <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">beq</span>     atoi_calc_power_exit<span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">dec</span>     <span style="color: #50a14f;">4</span>,SP                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">decrement pow var</span>

    <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">prepare for first shift</span>
    <span style="color: #e45649;">ldd</span>     <span style="color: #50a14f;">2</span>,SP                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">D = tmp</span>
    <span style="color: #e45649;">tfr</span>     D,Y                 <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">stash D in Y</span>

    <span style="color: #e45649;">lsld</span>                        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">D *= 8</span>
    <span style="color: #e45649;">lsld</span>                        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">lsld</span>                        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>

    <span style="color: #e45649;">std</span>     <span style="color: #50a14f;">2</span>,SP                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">tmp = D</span>

    <span style="color: #9ca0a4;">;; </span><span style="color: #9ca0a4;">prepare for shift again</span>
    <span style="color: #e45649;">tfr</span>     Y,D                 <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">retrieve D from Y</span>

    <span style="color: #e45649;">lsld</span>                        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">D *= 2</span>

    <span style="color: #e45649;">addd</span>    <span style="color: #50a14f;">2</span>,SP                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">tmp += D</span>
    <span style="color: #e45649;">std</span>     <span style="color: #50a14f;">2</span>,SP                  <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>

    <span style="color: #e45649;">bra</span>     atoi_calc_power_lp

<span style="color: #a626a4;">atoi_calc_power_exit</span>
    <span style="color: #e45649;">ldd</span>     <span style="color: #50a14f;">2</span>,SP                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">load tmp into D</span>
    <span style="color: #e45649;">addd</span>    SP                  <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">add tmp to accum</span>
    <span style="color: #e45649;">std</span>     SP                  <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">bra</span>     atoi_accumulate

<span style="color: #a626a4;">atoi_exit</span>
    <span style="color: #e45649;">ldd</span>     SP                  <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">D = accumulator</span>
    <span style="color: #e45649;">leas</span>    <span style="color: #50a14f;">6</span>,SP
    <span style="color: #e45649;">pulx</span>
    <span style="color: #e45649;">puly</span>
    <span style="color: #e45649;">rts</span>
<span style="color: #9ca0a4;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>

<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">is_dig</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Program:    determines if the value in A is an ascii digit</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Input:      A register: Ascii test value</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Output:     Modifies Zero bit in CCR</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Algorithm:</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">if A &lt; '0' or A &gt; '9':</span>
<span style="color: #9ca0a4;">;;;         </span><span style="color: #9ca0a4;">return false</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">else:</span>
<span style="color: #9ca0a4;">;;;         </span><span style="color: #9ca0a4;">return true</span>
<span style="color: #9ca0a4;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span style="color: #a626a4;">is_dig</span>
    <span style="color: #e45649;">cmpa</span>    #'<span style="color: #50a14f;">0</span>'                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">if A &lt; '0' or A &gt; '9' return false</span>
    <span style="color: #e45649;">blo</span>     is_dig_false        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">cmpa</span>    #'<span style="color: #50a14f;">9</span>'                <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>
    <span style="color: #e45649;">bhi</span>     is_dig_false        <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">|</span>

<span style="color: #a626a4;">is_dig_true</span>
    <span style="color: #e45649;">orcc</span>    #<span style="color: #6a1868;">%00000100</span>          <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">set Z bit in CCR</span>
    <span style="color: #e45649;">rts</span>

<span style="color: #a626a4;">is_dig_false</span>
    <span style="color: #e45649;">andcc</span>   #<span style="color: #6a1868;">%11111011</span>          <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">clear Z bit in CCR</span>
    <span style="color: #e45649;">rts</span>
<span style="color: #9ca0a4;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>

<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">print</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Program: Output character string to SCI port, print message</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Input:   Register X points to ASCII characters in memory</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Output:  message printed on the terminal connected to SCI port</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Registers modified: CCR</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Algorithm:</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">Pick up 1 byte from memory where X register is pointing</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">Send it out to SCI port</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">Update X register to point to the next byte</span>
<span style="color: #9ca0a4;">;;;     </span><span style="color: #9ca0a4;">Repeat until the byte data $00 is encountered</span>
<span style="color: #9ca0a4;">;;;       </span><span style="color: #9ca0a4;">(String is terminated with NULL=$00)</span>
<span style="color: #9ca0a4;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span style="color: #a626a4;">print</span>
    <span style="color: #e45649;">psha</span>                   <span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">Save registers</span>
    <span style="color: #e45649;">pshx</span>
<span style="color: #a626a4;">printmsgloop</span>
    <span style="color: #e45649;">ldaa</span>    <span style="color: #50a14f;">1</span>,X+           <span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">pick up an ASCII character from string</span>
                            <span style="color: #9ca0a4;">;   </span><span style="color: #9ca0a4;">pointed by X register</span>
                            <span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">then update the X register to point to</span>
                            <span style="color: #9ca0a4;">;   </span><span style="color: #9ca0a4;">the next byte</span>
    <span style="color: #e45649;">cmpa</span>    #NULL
    <span style="color: #e45649;">beq</span>     printmsgdone   <span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">end of strint yet?</span>
    <span style="color: #e45649;">jsr</span>     putchar        <span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">if not, print character and do next</span>
    <span style="color: #e45649;">bra</span>     printmsgloop

<span style="color: #a626a4;">printmsgdone</span>
    <span style="color: #e45649;">pulx</span>
    <span style="color: #e45649;">pula</span>
    <span style="color: #e45649;">rts</span>
<span style="color: #9ca0a4;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>



<span style="color: #9ca0a4;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">putchar</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Program: Send one character to SCI port, terminal</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Input:   Accumulator A contains an ASCII character, 8bit</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Output:  Send one character to SCI port, terminal</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Registers modified: CCR</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Algorithm:</span>
<span style="color: #9ca0a4;">;;;    </span><span style="color: #9ca0a4;">Wait for transmit buffer become empty</span>
<span style="color: #9ca0a4;">;;;      </span><span style="color: #9ca0a4;">Transmit buffer empty is indicated by TDRE bit</span>
<span style="color: #9ca0a4;">;;;      </span><span style="color: #9ca0a4;">TDRE = 1 : empty - Transmit Data Register Empty, ready to transmit</span>
<span style="color: #9ca0a4;">;;;      </span><span style="color: #9ca0a4;">TDRE = 0 : not empty, transmission in progress</span>
<span style="color: #9ca0a4;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span style="color: #a626a4;">putchar</span>
    <span style="color: #e45649;">brclr</span> SCISR1,#<span style="color: #6a1868;">%10000000</span>,putchar   <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">wait for transmit buffer empty</span>
    <span style="color: #e45649;">staa</span>  SCIDRL                      <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">send a character</span>
    <span style="color: #e45649;">rts</span>
<span style="color: #9ca0a4;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>

<span style="color: #9ca0a4;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">getchar</span>
<span style="color: #9ca0a4;">;;;</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Program: Input one character from SCI port (terminal/keyboard)</span>
<span style="color: #9ca0a4;">;;;             </span><span style="color: #9ca0a4;">if a character is received, other wise return NULL</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Input:   none</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Output:  Accumulator A containing the received ASCII character</span>
<span style="color: #9ca0a4;">;;;          </span><span style="color: #9ca0a4;">if a character is received.</span>
<span style="color: #9ca0a4;">;;;          </span><span style="color: #9ca0a4;">Otherwise Accumulator A will contain a NULL character, $00.</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Registers modified: CCR</span>
<span style="color: #9ca0a4;">;;; </span><span style="color: #9ca0a4;">Algorithm:</span>
<span style="color: #9ca0a4;">;;;    </span><span style="color: #9ca0a4;">Check for receive buffer become full</span>
<span style="color: #9ca0a4;">;;;      </span><span style="color: #9ca0a4;">Receive buffer full is indicated by RDRF bit</span>
<span style="color: #9ca0a4;">;;;      </span><span style="color: #9ca0a4;">RDRF = 1 : full - Receive Data Register Full, 1 byte received</span>
<span style="color: #9ca0a4;">;;;      </span><span style="color: #9ca0a4;">RDRF = 0 : not full, 0 byte received</span>
<span style="color: #9ca0a4;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span style="color: #a626a4;">getchar</span>
    <span style="color: #e45649;">brclr</span> SCISR1,#<span style="color: #6a1868;">%00100000</span>,getchar7
    <span style="color: #e45649;">ldaa</span>  SCIDRL
    <span style="color: #e45649;">rts</span>
<span style="color: #a626a4;">getchar7</span>
    <span style="color: #e45649;">clra</span>
    <span style="color: #e45649;">rts</span>
<span style="color: #9ca0a4;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>

<span style="color: #9ca0a4;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span style="color: #a626a4;">rtiisr</span>
    <span style="color: #e45649;">bset</span>    CRGFLG,<span style="color: #6a1868;">%10000000</span> <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">clear RTI Interrupt Flag - for the next one</span>
    <span style="color: #e45649;">ldx</span>     ctr2p5m          <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">every time the RTI occur, increase</span>
    <span style="color: #e45649;">inx</span>                      <span style="color: #9ca0a4;">;    </span><span style="color: #9ca0a4;">the 16bit interrupt count</span>
    <span style="color: #e45649;">stx</span>     ctr2p5m
    <span style="color: #e45649;">rti</span>

<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">OPTIONAL</span>
<span style="color: #9ca0a4;">;</span><span style="color: #9ca0a4;">more variable/data section below</span>
<span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">this is after the program code section</span>
<span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">of the RAM.  RAM ends at $3FFF</span>
<span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">in MC9S12C128 chip</span>

               <span style="color: #e45649;">END</span>               <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">this is end of assembly source file</span>
                                 <span style="color: #9ca0a4;">; </span><span style="color: #9ca0a4;">lines below are ignored - not assembled/compiled</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org6125223" class="outline-3">
<h3 id="org6125223">Computer Engineering 473</h3>
<div class="outline-text-3" id="text-org6125223">
<p>
This course was also taught by Professor Choi, the course webpage can be found
<a href="https://www.cse.psu.edu/~kxc104/class/cmpen473/22s/">here</a>. We spent the semester designing and building an autonomous robotic car
from scratch, using a Raspberry Pi 4. We started by learning how to access the
GPIO registers on the Pi in memory, using the <code>mmap</code> C function. From that point
on, continued to iterate on the design, constantly adding new features.
</p>

<p>
This course heavily incorporated multithreaded programming and interthread
communication. Most of my peers used the professors FIFO implementtion, but I
had already made a ringbuffer implentation by the time he distributed his
solution.
</p>

<div class="org-src-container">
<pre class="src src-c">
<span style="color: #4078f2; font-weight: bold;">#if</span><span style="color: #4078f2; font-weight: bold;">n</span><span style="color: #4078f2; font-weight: bold;">def</span> <span style="color: #b751b6;">RINGBUF_H</span>
<span style="color: #4078f2; font-weight: bold;">#define</span> <span style="color: #6a1868;">RINGBUF_H</span>

<span style="color: #4078f2; font-weight: bold;">#include</span> <span style="color: #4078f2;">&lt;</span><span style="color: #50a14f;">stdlib.h</span><span style="color: #4078f2;">&gt;</span>

<span style="color: #9ca0a4;">/*</span>
<span style="color: #9ca0a4;">*** Lock-Free thread messaging.</span>
<span style="color: #9ca0a4;">**</span>
<span style="color: #9ca0a4;">*** ring-buffer has designated producers and consumers. the read-head points to</span>
<span style="color: #9ca0a4;">*** the location of the next insertion, and the read-head points to the location</span>
<span style="color: #9ca0a4;">*** before the next read.</span>
<span style="color: #9ca0a4;">**</span>
<span style="color: #9ca0a4;">*** every time an element is inserted into the ringbuffer, the write_head is</span>
<span style="color: #9ca0a4;">*** incremented.</span>
<span style="color: #9ca0a4;">*/</span>
<span style="color: #e45649;">struct</span> <span style="color: #986801;">RingBuffer</span> <span style="color: #4078f2;">{</span>
    <span style="color: #986801;">char</span>* <span style="color: #6a1868;">_buffer</span>;
    <span style="color: #986801;">size_t</span> <span style="color: #6a1868;">length</span>;
    <span style="color: #986801;">size_t</span> <span style="color: #6a1868;">element_size</span>;

    <span style="color: #986801;">int</span> <span style="color: #6a1868;">write_head</span>;
    <span style="color: #986801;">int</span> <span style="color: #6a1868;">read_head</span>;
<span style="color: #4078f2;">}</span>;

<span style="color: #9ca0a4;">/// </span><span style="color: #9ca0a4;">wrapper struct. This struct is what is passed to the producer thread.</span>
<span style="color: #9ca0a4;">/// </span><span style="color: #9ca0a4;">the ringbuffer field is not meant to be directly accessed.</span>
<span style="color: #e45649;">struct</span> <span style="color: #986801;">Producer</span> <span style="color: #4078f2;">{</span>
    <span style="color: #e45649;">struct</span> <span style="color: #986801;">RingBuffer</span>* <span style="color: #6a1868;">_ringbuf</span>;
<span style="color: #4078f2;">}</span>;

<span style="color: #9ca0a4;">/// </span><span style="color: #9ca0a4;">wrapper struct. This struct is what is passed to the consumer thread.</span>
<span style="color: #9ca0a4;">/// </span><span style="color: #9ca0a4;">the ringbuffer field is not meant to be directly accessed.</span>
<span style="color: #e45649;">struct</span> <span style="color: #986801;">Consumer</span> <span style="color: #4078f2;">{</span>
    <span style="color: #e45649;">struct</span> <span style="color: #986801;">RingBuffer</span>* <span style="color: #6a1868;">_ringbuf</span>;
<span style="color: #4078f2;">}</span>;

<span style="color: #e45649;">struct</span> <span style="color: #986801;">RingBuffer</span> <span style="color: #a626a4;">ringbuf_new</span><span style="color: #4078f2;">(</span><span style="color: #986801;">size_t</span> <span style="color: #6a1868;">len</span>, <span style="color: #986801;">size_t</span> <span style="color: #6a1868;">element_size</span><span style="color: #4078f2;">)</span>;
<span style="color: #986801;">void</span> <span style="color: #a626a4;">ringbuf_del</span><span style="color: #4078f2;">(</span><span style="color: #e45649;">struct</span> <span style="color: #986801;">RingBuffer</span>* <span style="color: #6a1868;">ringbuf</span><span style="color: #4078f2;">)</span>;

<span style="color: #986801;">int</span> <span style="color: #a626a4;">ringbuf_next_index</span><span style="color: #4078f2;">(</span><span style="color: #e45649;">const</span> <span style="color: #e45649;">struct</span> <span style="color: #986801;">RingBuffer</span>* <span style="color: #6a1868;">rb</span>, <span style="color: #986801;">int</span> <span style="color: #6a1868;">index</span><span style="color: #4078f2;">)</span>;
<span style="color: #986801;">void</span> <span style="color: #a626a4;">ringbuf_print</span><span style="color: #4078f2;">(</span><span style="color: #e45649;">struct</span> <span style="color: #986801;">RingBuffer</span>* <span style="color: #6a1868;">rb</span><span style="color: #4078f2;">)</span>;

<span style="color: #e45649;">struct</span> <span style="color: #986801;">Producer</span> <span style="color: #a626a4;">ringbuf_make_producer</span><span style="color: #4078f2;">(</span><span style="color: #e45649;">struct</span> <span style="color: #986801;">RingBuffer</span>* <span style="color: #6a1868;">ringbuf</span><span style="color: #4078f2;">)</span>;

<span style="color: #9ca0a4;">/// </span><span style="color: #9ca0a4;">pushes value into the ringbuffer returns 0 on success.</span>
<span style="color: #9ca0a4;">/// </span><span style="color: #9ca0a4;">may fail if the ring buffer is full (ie, write-head runs into read-head).</span>
<span style="color: #9ca0a4;">/// </span><span style="color: #9ca0a4;">returns -1 on fail</span>
<span style="color: #986801;">int</span> <span style="color: #a626a4;">producer_push</span><span style="color: #4078f2;">(</span><span style="color: #e45649;">struct</span> <span style="color: #986801;">Producer</span>* <span style="color: #6a1868;">producer</span>, <span style="color: #986801;">void</span>* <span style="color: #6a1868;">val</span><span style="color: #4078f2;">)</span>;

<span style="color: #e45649;">struct</span> <span style="color: #986801;">Consumer</span> <span style="color: #a626a4;">ringbuf_make_consumer</span><span style="color: #4078f2;">(</span><span style="color: #e45649;">struct</span> <span style="color: #986801;">RingBuffer</span>* <span style="color: #6a1868;">ringbuf</span><span style="color: #4078f2;">)</span>;

<span style="color: #986801;">void</span>* <span style="color: #a626a4;">consumer_pop</span><span style="color: #4078f2;">(</span><span style="color: #e45649;">struct</span> <span style="color: #986801;">Consumer</span>* <span style="color: #6a1868;">consumer</span><span style="color: #4078f2;">)</span>;
<span style="color: #986801;">void</span>* <span style="color: #a626a4;">consumer_peek</span><span style="color: #4078f2;">(</span><span style="color: #e45649;">struct</span> <span style="color: #986801;">Consumer</span>* <span style="color: #6a1868;">consumer</span><span style="color: #4078f2;">)</span>;


<span style="color: #4078f2; font-weight: bold;">#endif</span> <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">RINGBUF_H</span>

</pre>
</div>
<object data="portfolio/ringbuf.h"></object>
</div>
<div id="outline-container-org19951d5" class="outline-4">
<h4 id="org19951d5">Manual Driving Mode</h4>
</div>


<div id="outline-container-org795359e" class="outline-4">
<h4 id="org795359e">Line Follow Mode (IR sensor)</h4>
</div>

<div id="outline-container-org3d37e32" class="outline-4">
<h4 id="org3d37e32">IMU Sensor Balence Board</h4>
</div>

<div id="outline-container-org90f3b44" class="outline-4">
<h4 id="org90f3b44">Line Follow Mode (Computer Vision)</h4>
</div>
</div>
</div>

<div id="outline-container-orgdd6c273" class="outline-2">
<h2 id="orgdd6c273">Programming</h2>
<div class="outline-text-2" id="text-orgdd6c273">
<p>
The projects I have listed below, along with others, can be found on my <a href="https://github.com/ethanxxxl">github</a>.
</p>
</div>

<div id="outline-container-orga7dca06" class="outline-3">
<h3 id="orga7dca06">Capabilities Overview</h3>
<div class="outline-text-3" id="text-orga7dca06">
<p>
I currently know the following languages well enough that I would be comfortable
working with them in a professional environment immediately:
</p>

<ul class="org-ul">
<li>C</li>
<li>C++</li>
<li>Rust</li>
<li>Assembly*</li>
<li>Python</li>
<li>Lisp**</li>
</ul>

<p>
*My experience is limited embedded systems (microcontrollers)<br>
**I mostly use Emacs Lisp
</p>

<p>
I am confident I could pick up just about any language relatively quickly, I am
currently in the process of learning haskell, which seems to be the hardest
language I have touched so far. I have used many more languages in the past, but
the ones I have listed I am most confident with.
</p>
</div>
</div>

<div id="outline-container-orgde0271a" class="outline-3">
<h3 id="orgde0271a">Code Wars</h3>
<div class="outline-text-3" id="text-orgde0271a">
<p>
Every once in a while, I like to spend some time working through programming
challenges on the codewars website. I think that it is a great way to hone
programming skills, and pick up new languages.
</p>

<img src="https://www.codewars.com/users/ethanxxxl/badges/large" alt="Codewars badge">
</div>
</div>

<div id="outline-container-org0840340" class="outline-3">
<h3 id="org0840340">Hack Chat</h3>
<div class="outline-text-3" id="text-org0840340">
<p>
I developed this application during the Summer of 2022, while I was at AFIT
learning about cyber warfare, network defense, and other topics. The idea is
simple: multiple clients can enter a chat room on the server. I had great ideas
for this project that never came to fruition, but I did leave implement the
fundumental features. I even had the courtesy to leave it in a working state!
</p>

<p>
Since hackchat is written in rust, you can try this for yourself by running the
following code (assuming your machine has cargo installed):
</p>

<div class="org-src-container">
<pre class="src src-bash">$ <span style="color: #986801;">git</span> clone https://github.com/ethanxxxl/hackchat.git
$ <span style="color: #986801;">cd</span> hackchat
$ cargo run --bin server
</pre>
</div>

<p>
You can run clients in a few more terminals. It will prompt you for an ip
address, which is printed by the server.
</p>

<div class="org-src-container">
<pre class="src src-bash">$ <span style="color: #986801;">cd</span> hackchat
$ cargo run --bin client
</pre>
</div>

<p>
An example of the program running and working is shown in the image below.
</p>


<div id="org1f6c590" class="figure">
<p><img src="../resources/portfolio/hackchat-demo.png" alt="hackchat-demo.png" width="700px" margin="auto">
</p>
</div>

<p>
Note, that I am running this on Arch Linux. It may work on MacOS, but I&rsquo;m pretty
sure it won&rsquo;t work on Windows.
</p>
</div>
</div>

<div id="outline-container-org07f2241" class="outline-3">
<h3 id="org07f2241">Rust-Snake</h3>
<div class="outline-text-3" id="text-org07f2241">
<p>
This was the first real program I wrote using Rust; A rudimentary implementation
of the classic game Snake. I Learned a lot about the language from this project.
Unfortunately, time has not been kind to this project. It is hosted on <a href="https://github.com/ethanxxxl/rust-snake">github</a>,
so you can peruse my code if you wish, but unfortunately, when I wrote this
program, I didn&rsquo;t have the forethought to create a binary, or even take pictures
of the final product.
</p>

<p>
I did spend about 30 minutes trying to get it to work, but I was not willing to
spend any more time on it.
</p>

</div>
</div>
</div>
</div>
</div>
</body>
</html>